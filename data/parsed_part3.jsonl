{"id": "1817da0e53", "source_url": "https://documentation.ubuntu.com/server/how-to/networking/serve-ntp-with-chrony/", "title": "How to serve the Network Time Protocol with Chrony - Ubuntu Server documentation", "text": "How to serve the Network Time Protocol with Chrony - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to serve the Network Time Protocol with Chrony\n¶\nAs of Ubuntu 25.10\nchrony\nis installed by default,\nfunctioning as a client\nand keeping your time in sync. However, if you also want to serve NTP information then you need an NTP server.\nBetween\nchrony\n, the now-deprecated\nntpd\n, and\nopen-ntp\n, there are plenty of options. The solution we recommend is\nchrony\n.\nThe NTP daemon\nchronyd\ncalculates the drift and offset of your system clock and continuously adjusts it, so there are no large corrections that could lead to inconsistent logs, for instance. The cost is a little processing power and memory, but for a modern server this is usually negligible.\nInstall\nchronyd\n¶\nTo install\nchrony\n, run the following command from a terminal prompt:\nsudo\napt\ninstall\nchrony\nThis will provide two binaries:\nchronyd\n- the actual daemon to sync and serve via the Network Time Protocol\nchronyc\n- command-line interface for the\nchrony\ndaemon\nEnable serving the Network Time Protocol\n¶\nYou can install\nchrony\n(above) and configure special Hardware (below) for a local synchronization\nand as-installed that is the default to stay on the secure and conservative side. But if you want to\nserve\nNTP you need adapt your configuration.\nTo enable serving NTP you’ll need to at least set the\nallow\nrule. This controls which clients/networks you want\nchrony\nto serve NTP to.\nAn example would be:\nallow 1.2.3.4\nSee the section “NTP server” in the\nchrony.conf(5)\nmanual page for more details on how you can control and restrict access to your NTP server.\nView\nchrony\nstatus\n¶\nYou can use\nchronyc\nto see query the status of the\nchrony\ndaemon. For example, to get an overview of the currently available and selected time sources, run\nchronyc\nsources\n, which provides output like this:\nMS Name/IP address         Stratum Poll Reach LastRx Last sample\n===============================================================================\n^+ gamma.rueckgr.at              2   8   377   135  -1048us[-1048us] +/-   29ms\n^- 2b.ncomputers.org             2   8   377   204  -1141us[-1124us] +/-   50ms\n^+ www.kashra.com                2   8   377   139  +3483us[+3483us] +/-   18ms\n^+ stratum2-4.NTP.TechFak.U>     2   8   377   143  -2090us[-2073us] +/-   19ms\n^- zepto.mcl.gg                  2   7   377     9   -774us[ -774us] +/-   29ms\n^- mirrorhost.pw                 2   7   377    78   -660us[ -660us] +/-   53ms\n^- atto.mcl.gg                   2   7   377     8   -823us[ -823us] +/-   50ms\n^- static.140.107.46.78.cli>     2   8   377     9  -1503us[-1503us] +/-   45ms\n^- 4.53.160.75                   2   8   377   137    -11ms[  -11ms] +/-  117ms\n^- 37.44.185.42                  3   7   377    10  -3274us[-3274us] +/-   70ms\n^- bagnikita.com                 2   7   377    74  +3131us[+3131us] +/-   71ms\n^- europa.ellipse.net            2   8   377   204   -790us[ -773us] +/-   97ms\n^- tethys.hot-chilli.net         2   8   377   141   -797us[ -797us] +/-   59ms\n^- 66-232-97-8.static.hvvc.>     2   7   377   206  +1669us[+1686us] +/-  133ms\n^+ 85.199.214.102                1   8   377   205   +175us[ +192us] +/-   12ms\n^* 46-243-26-34.tangos.nl        1   8   377   141   -123us[ -106us] +/-   10ms\n^- pugot.canonical.com           2   8   377    21    -95us[  -95us] +/-   57ms\n^- alphyn.canonical.com          2   6   377    23  -1569us[-1569us] +/-   79ms\n^- golem.canonical.com           2   7   377    92  -1018us[-1018us] +/-   31ms\n^- chilipepper.canonical.com     2   8   377    21  -1106us[-1106us] +/-   27ms\nYou can also make use of the\nchronyc\nsourcestats\ncommand, which produces output like this:\n210 Number of sources = 20\nName/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev\n==============================================================================\ngamma.rueckgr.at           25  15   32m     -0.007      0.142   -878us   106us\n2b.ncomputers.org          26  16   35m     -0.132      0.283  -1169us   256us\nwww.kashra.com             25  15   32m     -0.092      0.259  +3426us   195us\nstratum2-4.NTP.TechFak.U>  25  14   32m     -0.018      0.130  -2056us    96us\nzepto.mcl.gg               13  11   21m     +0.148      0.196   -683us    66us\nmirrorhost.pw               6   5   645     +0.117      0.445   -591us    19us\natto.mcl.gg                21  13   25m     -0.069      0.199   -904us   103us\nstatic.140.107.46.78.cli>  25  18   34m     -0.005      0.094  -1526us    78us\n4.53.160.75                25  10   32m     +0.412      0.110    -11ms    84us\n37.44.185.42               24  12   30m     -0.983      0.173  -3718us   122us\nbagnikita.com              17   7   31m     -0.132      0.217  +3527us   139us\neuropa.ellipse.net         26  15   35m     +0.038      0.553   -473us   424us\ntethys.hot-chilli.net      25  11   32m     -0.094      0.110   -864us    88us\n66-232-97-8.static.hvvc.>  20  11   35m     -0.116      0.165  +1561us   109us\n85.199.214.102             26  11   35m     -0.054      0.390   +129us   343us\n46-243-26-34.tangos.nl     25  16   32m     +0.129      0.297   -307us   198us\npugot.canonical.com        25  14   34m     -0.271      0.176   -143us   135us\nalphyn.canonical.com       17  11  1100     -0.087      0.360  -1749us   114us\ngolem.canonical.com        23  12   30m     +0.057      0.370   -988us   229us\nchilipepper.canonical.com  25  18   34m     -0.084      0.224  -1116us   169us\nCertain\nchronyc\ncommands are privileged and cannot be run via the network without explicitly allowing them. See the\nCommand and monitoring access\nsection in\nman\nchrony.conf\nfor more details. A local admin can use\nsudo\nsince this will grant access to the local admin socket\n/var/run/chrony/chronyd.sock\n.\nPulse-Per-Second (PPS) support\n¶\nChrony\nsupports various PPS types natively. It can use kernel PPS API as well as Precision Time Protocol (PTP) hardware clocks. Most general GPS receivers can be leveraged via\nGPSD\n. The latter (and potentially more) can be accessed via\nSHM\nor via a\nsocket\n(recommended). All of the above can be used to augment\nchrony\nwith additional high quality time sources for better accuracy,\njitter\n, drift, and longer- or shorter-term accuracy. Usually, each kind of clock type is good at one of those, but non-perfect at the others. For more details on configuration see some of the external PPS/GPSD resources listed below.\nNote\nAs of the release of 20.04, there was a bug which - until fixed - you might want to\nadd this content\nto your\n/etc/apparmor.d/local/usr.sbin.gpsd\n.\nExample configuration for GPSD to feed\nchrony\n¶\nFor the installation and setup you will first need to run the following command in your terminal window:\nsudo\napt\ninstall\ngpsd\nchrony\nHowever, since you will want to test/debug your setup (especially the GPS reception), you should also install:\nsudo\napt\ninstall\npps\n-\ntools\ngpsd\n-\nclients\nGPS devices usually communicate via serial interfaces. The most common type these days are USB GPS devices, which have a serial converter behind USB. If you want to use one of these devices for PPS then please be aware that the majority do not signal PPS via USB. Check the\nGPSD hardware\nlist for details. The examples below were run with a Navisys GR701-W.\nWhen plugging in such a device (or at boot time)\ndmesg\nshould report a serial connection of some sort, as in this example:\n[   52.442199] usb 1-1.1: new full-speed USB device number 3 using xhci_hcd\n[   52.546639] usb 1-1.1: New USB device found, idVendor=067b, idProduct=2303, bcdDevice= 4.00\n[   52.546654] usb 1-1.1: New USB device strings: Mfr=1, Product=2, SerialNumber=0\n[   52.546665] usb 1-1.1: Product: USB-Serial Controller D\n[   52.546675] usb 1-1.1: Manufacturer: Prolific Technology Inc. \n[   52.602103] usbcore: registered new interface driver usbserial_generic\n[   52.602244] usbserial: USB Serial support registered for generic\n[   52.609471] usbcore: registered new interface driver pl2303\n[   52.609503] usbserial: USB Serial support registered for pl2303\n[   52.609564] pl2303 1-1.1:1.0: pl2303 converter detected\n[   52.618366] usb 1-1.1: pl2303 converter now attached to ttyUSB0\nWe see in this example that the device appeared as\nttyUSB0\n. So that\nchrony\nlater accepts being fed time information by this device, we have to set it up in\n/etc/chrony/chrony.conf\n(please replace\nUSB0\nwith whatever applies to your setup):\nrefclock\nSHM\n0\nrefid\nGPS\nprecision\n1e-1\noffset\n0.9999\ndelay\n0.2\nrefclock\nSOCK\n/\nvar\n/\nrun\n/\nchrony\n.\nttyUSB0\n.\nsock\nrefid\nPPS\nNext, we need to restart\nchrony\nto make the socket available and have it waiting.\nsudo\nsystemctl\nrestart\nchrony\nWe then need to tell\ngpsd\nwhich device to manage. Therefore, in\n/etc/default/gpsd\nwe set:\nDEVICES\n=\n\"/dev/ttyUSB0\"\nIt should be noted that since the\ndefault\nuse-case of\ngpsd\nis, well, for\ngps position tracking\n, it will normally not consume any CPU since it is just waiting on a\nsocket\nfor clients. Furthermore, the client will tell\ngpsd\nwhat it requests, and\ngpsd\nwill only provide what is asked for.\nFor the use case of\ngpsd\nas a PPS-providing-daemon, you want to set the option to:\nImmediately start (even without a client connected). This can be set in\nGPSD_OPTIONS\nof\n/etc/default/gpsd\n:\nGPSD_OPTIONS=\"-n\"\nEnable the service itself and not wait for a client to reach the socket in the future:\nsudo\nsystemctl\nenable\n/lib/systemd/system/gpsd.service\nRestarting\ngpsd\nwill now initialize the PPS from GPS and in\ndmesg\nyou will see:\npps_ldisc: PPS line discipline registered\n pps pps0: new PPS source usbserial0\n pps pps0: source \"/dev/ttyUSB0\" added\nIf you have multiple PPS sources, the tool\nppsfind\nmay be useful to help identify which PPS belongs to which GPS. In our example, the command\nsudo\nppsfind\n/dev/ttyUSB0\nwould return the following:\npps0: name=usbserial0 path=/dev/ttyUSB0\nNow we have completed the basic setup. To proceed, we now need our GPS to get a lock. Tools like\ncgps\nor\ngpsmon\nneed to report a 3D “fix” in order to provide accurate data. Let’s run the command\ncgps\n, which in our case returns:\n...\n│ Status:         3D FIX (7 secs) ...\nYou would then want to use\nppstest\nin order to check that you are really receiving PPS data. So, let us run the command\nsudo\nppstest\n/dev/pps0\n, which will produce an output like this:\ntrying PPS source \"/dev/pps0\"\nfound PPS source \"/dev/pps0\"\nok, found 1 source(s), now start fetching data...\nsource 0 - assert 1588140739.099526246, sequence: 69 - clear  1588140739.999663721, sequence: 70\nsource 0 - assert 1588140740.099661485, sequence: 70 - clear  1588140739.999663721, sequence: 70\nsource 0 - assert 1588140740.099661485, sequence: 70 - clear  1588140740.999786664, sequence: 71\nsource 0 - assert 1588140741.099792447, sequence: 71 - clear  1588140740.999786664, sequence: 71\nOk,\ngpsd\nis now running, the GPS reception has found a fix, and it has fed this into\nchrony\n. Let’s check on that from the point of view of\nchrony\n.\nInitially, before\ngpsd\nhas started or before it has a lock, these sources will be new and “untrusted” - they will be marked with a “?” as shown in the example below. If your devices remain in the “?” state (even after some time) then\ngpsd\nis not feeding any data to\nchrony\nand you will need to debug why.\nchronyc> sources\n210 Number of sources = 10\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n#? GPS                           0   4     0     -     +0ns[   +0ns] +/-    0ns\n#? PPS                           0   4     0     -     +0ns[   +0ns] +/-    0ns\nOver time,\nchrony\nwill classify all of the unknown sources as “good” or “bad”.\nIn the example below, the raw GPS had too much deviation (+- 200ms) but the PPS is good (+- 63us).\nchronyc> sources\n210 Number of sources = 10\nMS Name/IP address        Stratum Poll Reach LastRx Last sample\n===============================================================================\n#x GPS                         0    4   177    24 -876ms[ -876ms] +/- 200ms\n#- PPS                         0    4   177    21 +916us[ +916us] +/- 63us\n^- chilipepper.canonical.com   2    6    37    53  +33us[ +33us]  +/- 33ms\nFinally, after a while it used the hardware PPS input (as it was better):\nchronyc> sources\n210 Number of sources = 10\nMS Name/IP address         Stratum Poll Reach LastRx Last sample\n===============================================================================\n#x GPS                           0   4   377    20   -884ms[ -884ms] +/-  200ms\n#* PPS                           0   4   377    18  +6677ns[  +52us] +/-   58us\n^- alphyn.canonical.com          2   6   377    20  -1303us[-1258us] +/-  114ms\nThe PPS might also be OK – but used in a combined way with the selected server, for example. See\nman\nchronyc\nfor more details about how these combinations can look:\nchronyc> sources\n210 Number of sources = 11\nMS Name/IP address         Stratum Poll Reach LastRx Last sample               \n===============================================================================\n#? GPS                           0   4     0     -     +0ns[   +0ns] +/-    0ns\n#+ PPS                           0   4   377    22   +154us[ +154us] +/- 8561us\n^* chilipepper.canonical.com     2   6   377    50   -353us[ -300us] +/-   44ms\nIf you’re wondering if your SHM-based GPS data is any good, you can check on that as well.\nchrony\nwill not only tell you if the data is classified as good or bad – using\nsourcestats\nyou can also check the details:\nchronyc> sourcestats\n210 Number of sources = 10\nName/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev\n==============================================================================\nGPS                        20   9   302     +1.993     11.501   -868ms  1208us\nPPS                         6   3    78     +0.324      5.009  +3365ns    41us\ngolem.canonical.com        15  10   783     +0.859      0.509   -750us   108us\nYou can also track the raw data that\ngpsd\nor other\nntpd\n-compliant reference clocks are sending via shared memory by using\nntpshmmon\n. Let us run the command\nsudo\nntpshmmon\n-o\n, which should provide the following output:\nntpshmmon: version 3.20\n#      Name          Offset       Clock                 Real                 L Prc\nsample NTP1          0.000223854  1588265805.000223854  1588265805.000000000 0 -10\nsample NTP0          0.125691783  1588265805.125999851  1588265805.000308068 0 -20\nsample NTP1          0.000349341  1588265806.000349341  1588265806.000000000 0 -10\nsample NTP0          0.130326636  1588265806.130634945  1588265806.000308309 0 -20\nsample NTP1          0.000485216  1588265807.000485216  1588265807.000000000 0 -10\nNTS Support\n¶\nIn Chrony 4.0 (which first appeared in Ubuntu 21.04 Hirsute) support for\nNetwork Time Security “NTS”\nwas added.\nNTS server\n¶\nTo set up your server with NTS you’ll need certificates so that the server can authenticate itself and, based on that, allow the encryption and verification of NTP traffic.\nIn addition to the\nallow\nstatement that any\nchrony\n(while working as an NTP server) needs there are two mandatory config entries that will be needed. Example certificates for those entries would look like:\nntsservercert /etc/chrony/fullchain.pem\nntsserverkey /etc/chrony/privkey.pem\nIt is important to note that for isolation reasons\nchrony\n, by default, runs as user and group\n_chrony\n. Therefore you need to grant access to the certificates for that user, by running the following command:.\nsudo\nchown\n_chrony:_chrony\n/etc/chrony/*.pem\nThen restart\nchrony\nwith\nsystemctl\nrestart\nchrony\nand it will be ready to provide NTS-based time services.\nA running\nchrony\nserver measures various statistics. One of them counts the number of NTS connections that were established (or dropped) – we can check this by running\nsudo\nchronyc\n-N\nserverstats\n, which shows us the statistics:\nNTP packets received       : 213\nNTP packets dropped        : 0\nCommand packets received   : 117\nCommand packets dropped    : 0\nClient log records dropped : 0\nNTS-KE connections accepted: 2\nNTS-KE connections dropped : 0\nAuthenticated NTP packets  : 197\nThere is also a per-client statistic which can be enabled by the\n-p\noption of the\nclients\ncommand.\nsudo\nchronyc\n-N\nclients\n-k\nThis provides output in the following form:\nHostname                      NTP   Drop Int IntL Last  NTS-KE   Drop Int  Last\n    ===============================================================================\n    10.172.196.173                197      0  10   -   595       2      0   5   48h\n    ...\nFor more complex scenarios there are many more advanced options for configuring NTS. These are documented in the\nchrony.conf(5)\nmanual page.\nNote\nAbout certificate placement\nChrony, by default, is isolated via AppArmor and uses a number of\nprotect*\nfeatures of\nsystemd\n. Due to that, there are not many paths\nchrony\ncan access for the certificates. But\n/etc/chrony/*\nis allowed as read-only and that is enough.\nCheck\n/etc/apparmor.d/usr.sbin.chronyd\nif you want other paths or allow custom paths in\n/etc/apparmor.d/local/usr.sbin.chronyd\n.\nReferences\n¶\nChrony FAQ\nntp.org: home of the Network Time Protocol project\npool.ntp.org: project of virtual cluster of timeservers\nFreedesktop.org info on timedatectl\nFreedesktop.org info on systemd-timesyncd service\nFeeding chrony from GPSD\nSee the\nUbuntu Time\nwiki page for more information.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:22Z", "original_len_words": 2514}}
{"id": "ba3be6bb74", "source_url": "https://documentation.ubuntu.com/server/how-to/networking/timedatectl-and-timesyncd/", "title": "Synchronize time using timedatectl and timesyncd - Ubuntu Server documentation", "text": "Synchronize time using timedatectl and timesyncd - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nSynchronize time using timedatectl and timesyncd\n¶\nUbuntu can use\ntimedatectl\nand\ntimesyncd\nfor synchronizing time, which can be installed as follows.\nsystemd-timesyncd\nused to be part of the default installation, but was replaced by\nchrony\nsince Ubuntu 25.10. You can optionally use\nchrony\nas a\nNetwork Time Security (NTS) client\nor to\nserve the Network Time Protocol\n.\nsudo\napt-mark\nauto\nchrony\n&&\napt\ninstall\nsystemd-timesyncd\nIn this guide, we will show you how to configure these services.\nNote\nIf\nchrony\nis installed,\ntimedatectl\nsteps back to let\nchrony\nhandle timekeeping. This ensures that no two time-syncing services will be in conflict.\nCheck status of\ntimedatectl\n¶\nThe current status of time and time configuration via\ntimedatectl\nand\ntimesyncd\ncan be checked with the\ntimedatectl\nstatus\ncommand, which will produce output like this:\nLocal time: Wed 2023-06-14 12:05:11 BST\n           Universal time: Wed 2023-06-14 11:05:11 UTC\n                 RTC time: Wed 2023-06-14 11:05:11\n                Time zone: Europe/Isle_of_Man (BST, +0100)\nSystem clock synchronized: yes\n              NTP service: active\n          RTC in local TZ: no\nIf\nchrony\nis running, it will automatically switch to:\n[...]\n systemd-timesyncd.service active: no\nConfigure\ntimedatectl\n¶\nBy using\ntimedatectl\n, an admin can control the timezone, how the system clock should relate to the\nhwclock\nand whether permanent synchronization should be enabled. See\nman\ntimedatectl\nfor more details.\nCheck status of\ntimesyncd\n¶\ntimesyncd\nitself is a normal service, so you can check its status in more detail using:\nsystemctl\nstatus\nsystemd\n-\ntimesyncd\nThe output produced will look something like this:\nsystemd\n-\ntimesyncd\n.\nservice\n-\nNetwork\nTime\nSynchronization\nLoaded\n:\nloaded\n(\n/\nlib\n/\nsystemd\n/\nsystem\n/\nsystemd\n-\ntimesyncd\n.\nservice\n;\nenabled\n;\nvendor\npreset\n:\nenabled\n)\nActive\n:\nactive\n(\nrunning\n)\nsince\nFri\n2018\n-\n02\n-\n23\n08\n:\n55\n:\n46\nUTC\n;\n10\ns\nago\nDocs\n:\nman\n:\nsystemd\n-\ntimesyncd\n.\nservice\n(\n8\n)\nMain\nPID\n:\n3744\n(\nsystemd\n-\ntimesyn\n)\nStatus\n:\n\"Synchronized to time server 91.189.89.198:123 (ntp.ubuntu.com).\"\nTasks\n:\n2\n(\nlimit\n:\n4915\n)\nCGroup\n:\n/\nsystem\n.\nslice\n/\nsystemd\n-\ntimesyncd\n.\nservice\n|-\n3744\n/\nlib\n/\nsystemd\n/\nsystemd\n-\ntimesyncd\nFeb\n23\n08\n:\n55\n:\n46\nbionic\n-\ntest\nsystemd\n[\n1\n]:\nStarting\nNetwork\nTime\nSynchronization\n...\nFeb\n23\n08\n:\n55\n:\n46\nbionic\n-\ntest\nsystemd\n[\n1\n]:\nStarted\nNetwork\nTime\nSynchronization\n.\nFeb\n23\n08\n:\n55\n:\n46\nbionic\n-\ntest\nsystemd\n-\ntimesyncd\n[\n3744\n]:\nSynchronized\nto\ntime\nserver\n91.189.89.198\n:\n123\n(\nntp\n.\nubuntu\n.\ncom\n)\n.\nConfigure\ntimesyncd\n¶\nThe server from which to fetch time for\ntimedatectl\nand\ntimesyncd\ncan be specified in\n/etc/systemd/timesyncd.conf\n. Additional config files can be stored in\n/etc/systemd/timesyncd.conf.d/\n. The entries for\nNTP=\nand\nFallbackNTP=\nare space-separated lists. See\nman\ntimesyncd.conf\nfor more details.\nNext steps\n¶\nIf you would now like to serve the Network Time Protocol via\nchrony\n, this guide will walk you through\nhow to install and configure your setup\n.\nReferences\n¶\nFreedesktop.org info on timedatectl\nFreedesktop.org info on systemd-timesyncd service\nSee the\nUbuntu Time wiki page\nfor more information.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:22Z", "original_len_words": 565}}
{"id": "a1407c1165", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/", "title": "Observability - Ubuntu Server documentation", "text": "Observability - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nObservability\n¶\nIn Ubuntu, it is recommended to use the\nCanonical Observability Stack\nto monitor your infrastructure.\nHowever, you can also use the classic Logging, Monitoring and Alerting (LMA) stack.\nSet up your LMA stack\nIf you do not need a full LMA stack, there are some other supported tools that can provide similar capabilities.\nInstall Logwatch\nInstall Munin\nInstall Nagios Core 3\nUse Nagios with Munin", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:22Z", "original_len_words": 98}}
{"id": "5bc3bbfc13", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/install-logwatch/", "title": "How to install and configure Logwatch - Ubuntu Server documentation", "text": "How to install and configure Logwatch - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to install and configure Logwatch\n¶\nLogs are an invaluable source of information about problems that may arise in your server.\nLogwatch\nkeeps an eye on your logs for you, flags items that may be of interest, and reports them via email.\nInstall Logwatch\n¶\nInstall\nlogwatch\nusing the following command:\nsudo\napt\ninstall\nlogwatch\nYou will also need to manually create a temporary directory in order for it to work:\nsudo\nmkdir\n/var/cache/logwatch\nConfigure\nlogwatch\n¶\nLogwatch’s default configuration is kept in\n/usr/share/logwatch/default.conf/logwatch.conf\n. However, configuration changes made directly to that file can be overwritten during updates, so instead the file should be copied into\n/etc\nand modified there:\nsudo\ncp\n/\nusr\n/\nshare\n/\nlogwatch\n/\ndefault\n.\nconf\n/\nlogwatch\n.\nconf\n/\netc\n/\nlogwatch\n/\nconf\n/\nWith your favorite editor, open\n/etc/logwatch/conf/logwatch.conf\n.  The uncommented lines indicate the default configuration values.  First, lets customize some of the basics:\nOutput = mail\nMailTo = me@mydomain.org\nMailFrom = logwatch@host1.mydomain.org\nDetail = Low\nService = All\nThis assumes you’ve already set up mail services on\nhost1\nthat will allow mail to be delivered to your\nme@mydomain.org\naddress. These emails will be addressed from\nlogwatch@host1.mydomain.org\n.\nThe\nDetail\nlevel defines how much information is included in the reports. Possible values are:\nLow\n,\nMedium\n, and\nHigh\n.\nLogwatch will then monitor logs for all services on the system, unless specified otherwise with the\nService\nparameter.  If there are undesired services included in the reports, they can be disabled by removing them with additional\nService\nfields. E.g.:\nService = \"-http\"\nService = \"-eximstats\"\nNext, run\nlogwatch\nmanually to verify your configuration changes are valid:\nsudo\nlogwatch\n--detail\nLow\n--range\ntoday\nThe report produced should look something like this:\n################### Logwatch 7.4.3 (12/07/16) ####################\n       Processing Initiated: Fri Apr 24 16:58:14 2020\n       Date Range Processed: today\n                             ( 2020-Apr-24 )\n                             Period is day.\n       Detail Level of Output: 0\n       Type of Output/Format: stdout / text\n       Logfiles for Host: `host1.mydomain.org`\n##################################################################\n \n--------------------- pam_unix Begin ------------------------\n \nsudo:\n   Sessions Opened:\n      bryce -> root: 1 Time(s)\n \n \n---------------------- pam_unix End -------------------------\n \n \n--------------------- rsnapshot Begin ------------------------\n \nERRORS:\n    /usr/bin/rsnapshot hourly: completed, but with some errors: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host2:/etc/: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host2:/home/: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host2:/proc/uptime: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host3:/etc/: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host3:/home/: 5 Time(s)\n    /usr/bin/rsync returned 127 while processing root@host3:/proc/uptime: 5 Time(s)\n \n \n---------------------- rsnapshot End -------------------------\n \n \n--------------------- SSHD Begin ------------------------\n \n \nUsers logging in through sshd:\n   bryce:\n      192.168.1.123 (`host4.mydomain.org`): 1 time\n \n---------------------- SSHD End -------------------------\n \n \n--------------------- Sudo (secure-log) Begin ------------------------\n \n \nbryce => root\n\\-------------\n/bin/bash                      -   1 Time(s).\n \n---------------------- Sudo (secure-log) End -------------------------\n \n \n--------------------- Disk Space Begin ------------------------\n \nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sdc1       220G   19G  190G   9% /\n/dev/loop1      157M  157M     0 100% /snap/gnome-3-28-1804/110\n/dev/loop11     1.0M  1.0M     0 100% /snap/gnome-logs/81\n/dev/md5        9.1T  7.3T  1.8T  81% /srv/Products\n/dev/md6        9.1T  5.6T  3.5T  62% /srv/Archives\n/dev/loop14     3.8M  3.8M     0 100% /snap/gnome-system-monitor/127\n/dev/loop17      15M   15M     0 100% /snap/gnome-characters/399\n/dev/loop18     161M  161M     0 100% /snap/gnome-3-28-1804/116\n/dev/loop6       55M   55M     0 100% /snap/core18/1668\n/dev/md1        1.8T  1.3T  548G  71% /srv/Staff\n/dev/md0        3.6T  3.5T   84G  98% /srv/Backup\n/dev/loop2      1.0M  1.0M     0 100% /snap/gnome-logs/93\n/dev/loop5       15M   15M     0 100% /snap/gnome-characters/495\n/dev/loop8      3.8M  3.8M     0 100% /snap/gnome-system-monitor/135\n/dev/md7        3.6T  495G  3.0T  15% /srv/Customers\n/dev/loop9       55M   55M     0 100% /snap/core18/1705\n/dev/loop10      94M   94M     0 100% /snap/core/8935\n/dev/loop0       55M   55M     0 100% /snap/gtk-common-themes/1502\n/dev/loop4       63M   63M     0 100% /snap/gtk-common-themes/1506\n/dev/loop3       94M   94M     0 100% /snap/core/9066\n\n/srv/Backup (/dev/md0) => 98% Used. Warning. Disk Filling up.\n \n---------------------- Disk Space End -------------------------\n \n \n###################### Logwatch End #########################\nFurther reading\n¶\nThe Ubuntu\nlogwatch(8)\nmanpage contains many more detailed options.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:23Z", "original_len_words": 646}}
{"id": "d6edb2aa59", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/install-munin/", "title": "How to install and configure Munin - Ubuntu Server documentation", "text": "How to install and configure Munin - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to install and configure Munin\n¶\nThe monitoring of essential servers and services is an important part of system administration. This guide will show you how to set up\nMunin\nfor performance monitoring.\nIn this example, we will use two servers with\nhostnames\n:\nserver01\nand\nserver02\n.\nServer01\nwill be set up with the\nmunin\npackage to gather information from the network. Using the\nmunin-node\npackage,\nserver02\nwill be configured to send information to\nserver01\n.\nPrerequisites\n¶\nBefore installing Munin on\nserver01\n,\nApache2 will need to be installed\n. The default configuration is fine for running a\nmunin\nserver.\nInstall\nmunin\nand\nmunin-node\n¶\nFirst, on\nserver01\ninstall the\nmunin\npackage. In a terminal enter the following command:\nsudo\napt\ninstall\nmunin\nNow on\nserver02\n, install the\nmunin-node\npackage:\nsudo\napt\ninstall\nmunin-node\nConfigure\nmunin\n¶\nOn\nserver01\nedit the\n/etc/munin/munin.conf\nfile, adding the IP address for\nserver02\n:\n## First our \"normal\" host.\n[server02]\n       address 172.18.100.101\nNote\nReplace\nserver02\nand\n172.18.100.101\nwith the actual hostname and IP address for your server.\nConfigure\nmunin-node\n¶\nNext, configure\nmunin-node\non\nserver02\n. Edit\n/etc/munin/munin-node.conf\nto allow access by\nserver01\n:\nallow ^172\\.18\\.100\\.100$\nNote\nReplace\n^172\\.18\\.100\\.100$\nwith the IP address for your\nmunin\nserver.\nNow restart\nmunin-node\non\nserver02\nfor the changes to take effect:\nsudo\nsystemctl\nrestart\nmunin-node.service\nTest the setup\n¶\nIn a browser, go to\nhttp://server01/munin\n, and you should see links to nice graphs displaying information from the standard\nmunin-plugins\nfor disk, network, processes, and system. However, it should be noted that since this is a new installation, it may take some time for the graphs to display anything useful.\nAdditional Plugins\n¶\nThe\nmunin-plugins-extra\npackage contains performance checks and additional services such as\nDNS\n,\nDHCP\n, and Samba, etc. To install the package, from a terminal enter:\nsudo\napt\ninstall\nmunin-plugins-extra\nBe sure to install the package on both the server and node machines.\nReferences\n¶\nSee the\nMunin\nwebsite for more details.\nSpecifically the\nMunin Documentation\npage includes information on additional plugins, writing plugins, etc.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:23Z", "original_len_words": 381}}
{"id": "9e84a80e1a", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/install-nagios/", "title": "How to install and configure Nagios Core 3 - Ubuntu Server documentation", "text": "How to install and configure Nagios Core 3 - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to install and configure Nagios Core 3\n¶\nNote\nNagios Core 3 has been deprecated and is now replaced by Nagios Core 4. The\nnagios3\npackage was last supported in Bionic, so subsequent releases should use\nnagios4\ninstead.\nThe monitoring of essential servers and services is an important part of system administration. This guide walks through how to install and configure Nagios Core 3 for availability monitoring.\nThe example in this guide uses two servers with\nhostnames\n:\nserver01\nand\nserver02\n.\nServer01\nwill be configured with Nagios to monitor services on itself and on\nserver02\n, while\nserver02\nwill be configured to send data to\nserver01\n.\nInstall\nnagios3\non\nserver01\n¶\nFirst, on\nserver01\n, install the\nnagios3\npackage by entering the following command into your terminal:\nsudo\napt\ninstall\nnagios3\nnagios-nrpe-plugin\nYou will be asked to enter a password for the\nnagiosadmin\nuser. The user’s credentials are stored in\n/etc/nagios3/htpasswd.users\n. To change the nagiosadmin password, or add more users to the Nagios CGI scripts, use the\nhtpasswd\nthat is part of the\napache2-utils\npackage.\nFor example, to change the password for the nagiosadmin user, enter:\nsudo\nhtpasswd\n/etc/nagios3/htpasswd.users\nnagiosadmin\nTo add a user:\nsudo\nhtpasswd\n/etc/nagios3/htpasswd.users\nsteve\nInstall\nnagios-nrpe-server\non\nserver02\n¶\nNext, on\nserver02\ninstall the\nnagios-nrpe-server\npackage. From a terminal on\nserver02\nenter:\nsudo\napt\ninstall\nnagios-nrpe-server\nNote\nNRPE allows you to execute local checks on remote hosts. There are other ways of accomplishing this through other Nagios plugins, as well as other checks.\nConfiguration overview\n¶\nThere are a couple of directories containing Nagios configuration and check files.\n/etc/nagios3\n: Contains configuration files for the operation of the Nagios daemon, CGI files, hosts, etc.\n/etc/nagios-plugins\n: Contains configuration files for the service checks.\n/etc/nagios\n: On the remote host, contains the\nnagios-nrpe-server\nconfiguration files.\n/usr/lib/nagios/plugins/\n: Where the check binaries are stored. To see the options of a check use the\n-h\noption. For example:\n/usr/lib/nagios/plugins/check_dhcp\n-h\nThere are multiple checks Nagios can be configured to execute for any given host. For this example, Nagios will be configured to check disk space,\nDNS\n, and a MySQL\nhostgroup\n. The DNS check will be on\nserver02\n, and the MySQL hostgroup will include both\nserver01\nand\nserver02\n.\nNote\nSee these guides for details on\nsetting up Apache\n,\nDomain Name Service\n, and\nMySQL\n.\nAdditionally, there are some terms that once explained will hopefully make understanding Nagios configuration easier:\nHost\n: A server, workstation, network device, etc. that is being monitored.\nHost Group\n: A group of similar hosts. For example, you could group all web servers, file server, etc.\nService\n: The service being monitored on the host, such as HTTP, DNS, NFS, etc.\nService Group\n: Allows you to group multiple services together. This is useful for grouping multiple HTTP for example.\nContact\n: Person to be notified when an event takes place. Nagios can be configured to send emails, SMS messages, etc.\nBy default, Nagios is configured to check HTTP, disk space, SSH, current users, processes, and load on the\nlocalhost\n. Nagios will also ping check the\ngateway\n.\nLarge Nagios installations can be quite complex to configure. It is usually best to start small, with one or two hosts, to get things configured the way you want before expanding.\nConfigure Nagios\n¶\nCreate host config file for server02\n¶\nFirst, create a\nhost\nconfiguration file for\nserver02\n. Unless otherwise specified, run all these commands on\nserver01\n. In a terminal enter:\nsudo\ncp\n/etc/nagios3/conf.d/localhost_nagios2.cfg\n\\\n/etc/nagios3/conf.d/server02.cfg\nNote\nIn all command examples, replace “\nserver01\n”, “\nserver02\n”,\n172.18.100.100\n, and\n172.18.100.101\nwith the host names and IP addresses of your servers.\nEdit the host config file\n¶\nNext, edit\n/etc/nagios3/conf.d/server02.cfg\n:\ndefine host{\n        use                     generic-host  ; Name of host template to use\n        host_name               server02\n        alias                   Server 02\n        address                 172.18.100.101\n}\n        \n# check DNS service.\ndefine service {\n        use                             generic-service\n        host_name                       server02\n        service_description             DNS\n        check_command                   check_dns!172.18.100.101\n}\nRestart the Nagios daemon to enable the new configuration:\nsudo\nsystemctl\nrestart\nnagio3.service\nAdd service definition\n¶\nNow add a service definition for the MySQL check by adding the following to\n/etc/nagios3/conf.d/services_nagios2.cfg\n:\n# check MySQL servers.\ndefine service {\n        hostgroup_name        mysql-servers\n        service_description   MySQL\n        check_command         check_mysql_cmdlinecred!nagios!secret!$HOSTADDRESS\n        use                   generic-service\n        notification_interval 0 ; set > 0 if you want to be renotified\n}\nA\nmysql-servers\nhostgroup now needs to be defined. Edit\n/etc/nagios3/conf.d/hostgroups_nagios2.cfg\nand add the following:\n# MySQL hostgroup.\ndefine hostgroup {\n        hostgroup_name  mysql-servers\n                alias           MySQL servers\n                members         localhost, server02\n        }\nThe Nagios check needs to authenticate to MySQL. To add a\nnagios\nuser to MySQL enter:\nmysql\n-u\nroot\n-p\n-e\n\"create user nagios identified by 'secret';\"\nNote\nThe\nnagios\nuser will need to be added to all hosts in the\nmysql-servers\nhostgroup.\nRestart nagios to start checking the MySQL servers.\nsudo systemctl restart nagios3.service\nConfigure NRPE\n¶\nLastly configure NRPE to check the disk space on\nserver02\n.\nOn\nserver01\nadd the service check to\n/etc/nagios3/conf.d/server02.cfg\n:\n# NRPE disk check.\ndefine service {\n        use                     generic-service\n        host_name               server02\n        service_description     nrpe-disk\n        check_command           check_nrpe_1arg!check_all_disks!172.18.100.101\n}\nNow on\nserver02\nedit\n/etc/nagios/nrpe.cfg\nchanging:\nallowed_hosts=172.18.100.100\nAnd below, in the command definition area, add:\ncommand[check_all_disks]=/usr/lib/nagios/plugins/check_disk -w 20% -c 10% -e\nFinally, restart\nnagios-nrpe-server\n:\nsudo\nsystemctl\nrestart\nnagios-nrpe-server.service\nAlso, on\nserver01\nrestart Nagios:\nsudo\nsystemctl\nrestart\nnagios3.service\nYou should now be able to see the host and service checks in the Nagios CGI files. To access them, point a browser to\nhttp://server01/nagios3\n. You will then be prompted for the\nnagiosadmin\nusername and password.\nFurther reading\n¶\nThis section has just scratched the surface of Nagios’ features. The\nnagios-plugins-extra\nand\nnagios-snmp-plugins\ncontain many more service checks.\nFor more information about Nagios, see\nthe Nagios website\n.\nThe\nNagios Core Documentation\nand\nNagios Core 3 Documentation\nmay also be useful.\nThey also provide a\nlist of books\nrelated to Nagios and network monitoring.\nThe\nNagios Ubuntu Wiki\npage also has more details.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:23Z", "original_len_words": 1027}}
{"id": "b06d3eb7c3", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/set-up-your-lma-stack/", "title": "Set up your LMA stack - Ubuntu Server documentation", "text": "Set up your LMA stack - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nSet up your LMA stack\n¶\nNote\nLMA to COS\nThe LMA stack is being succeeded by the Canonical Observability Stack (COS). While the current LMA still works, most users are recommended to consider COS instead. For more information, refer to\nthis COS topic\n. In environments with more limited resources, there is also\nCOS lite\n.\nLogging, Monitoring, and Alerting (LMA) is a collection of tools that guarantee the availability of your running infrastructure. Your LMA stack will help point out issues in load, networking, and other resources before they become a failure point.\nArchitectural overview\n¶\nCanonical’s LMA stack involves several discrete software services acting in concert.\nTelegraf\ncollects metrics from the operating system, running software, and other inputs. Its plugin system permits export of data in any arbitrary format; for this system we collect the data in a central data manager called\nPrometheus\n.\nPrometheus works as a hub, polling data from different Telegraf nodes and sending it to various outputs, including persistent storage. For this LMA stack, visualization is handled via\nGrafana\nand email/pager alerts are generated via the Prometheus\nAlertmanager\nplugin. See\nPrometheus Alertmanager\nfor more details.\nGetting started\n¶\nLet’s set up a basic demonstration with two\nnodes\n, the first acting as a placeholder load with Telegraf installed - the “Workload”, and the second acting as our data visualization system - the “Monitor”. This will help us familiarize ourselves with the various components and how they inter-operate.\nNote\nFor clarity, we’ll refer to these two hosts as named:\nworkload\nand\nmonitor\n. If you use other\nhostnames\n, substitute your preferred names as we go through this guide.\nThe Workload node will be running Telegraf to collect metrics from whatever load we’re monitoring. For demonstration purposes we’ll just read the CPU/memory data from the node. In a real environment, we’d have multiple hosts (each with their own Telegraf instance) collecting hardware, network, and software statuses particular to that node.\nOur Monitor node will double as both a data store and a web UI, receiving data from the Workload, storing it to disk, and displaying it for analysis.\nPorts\n¶\nAs reference, here are the ports we’ll be binding for each service:\nPrometheus\nmonitor:9090\nAlertmanager\nmonitor:9093\nGrafana\nmonitor:3000\nTelegraf\nworkload:9273\nSet up the Workload node\n¶\nFirst, let’s set up the Workload. We’ll be using LXD as our container technology in this guide, but any VM, container, or bare metal host should work, so long as it’s running Ubuntu 20.10. With LXD installed on our host we can use its\nlxc\ncommand line tool to create our containers:\n$\nlxc\nlaunch\nubuntu:20.10\nworkload\nCreating\nworkload\nStarting\nworkload\n\n$\nlxc\nexec\nworkload\n--\nbash\nworkload:~#\nOn the Workload, install Telegraf:\nworkload:~#\napt\nupdate\nworkload:~#\napt\ninstall\ntelegraf\nTelegraf processes input data to transform, filter, and decorate it, and then performs selected aggregation functions on it such as tallies, averages, etc. The results are published for collection by external services; in our case Prometheus will be collecting the CPU/memory data from the Monitor node.\nOpen\n/etc/telegraf/telegraf.conf\nand scroll down to the “INPUT PLUGINS” section. What we’ll need is the following configuration settings, which you should find already enabled by default:\n[[inputs.cpu]]\n  percpu = true\n  totalcpu = true\n  collect_cpu_time = false\n  report_active = false\nLooking at the config file you’ll notice it’s almost entirely commented out. There are three different types of sections in the file:\n[[inputs]]\n, which we set above;\n[[outputs]]\n, which we’ll set up next; and the\n[[agent]]\nsetting, with several performance tuning parameters such as the collection interval, which we’re setting to 10 seconds. The agent defaults are fine for our example and for basic use.\nFinally, we need to define where Telegraf will provide its output. Open\n/etc/telegraf/telegraf.conf\nand scroll down to the “OUTPUT PLUGINS” section and add the following output configuration:\n[[outputs.prometheus_client]]\n  listen = \"workload:9273\"\n  metric_version = 2\n\n#[[outputs.influxdb]]\nWe won’t be using\nInfluxdb\n, so you can comment that section out (if it’s enabled).\nNow restart the Telegraf service:\nworkload:~#\nsystemctl\nrestart\ntelegraf\nworkload:~#\nsystemctl\nstatus\ntelegraf\n●\ntelegraf.service\n-\nThe\nplugin-driven\nserver\nagent\nfor\nreporting\nmetrics\ninto\nInfluxDB\nLoaded:\nloaded\n(\n/lib/systemd/system/telegraf.service\n;\nenabled\n;\nvendor\npreset:\nenabled\n)\nActive:\nactive\n(\nrunning\n)\nsince\nSat\n2020\n-10-31\n02\n:17:57\nUTC\n;\n6s\nago\nDocs:\nhttps://github.com/influxdata/telegraf\nMain\nPID:\n2562\n(\ntelegraf\n)\nTasks:\n17\n(\nlimit:\n77021\n)\nMemory:\n42\n.2M\nCGroup:\n/system.slice/telegraf.service\n└─2562\n/usr/bin/telegraf\n-config\n/etc/telegraf/telegraf.conf\n-config-directory\n/etc/telegraf/telegraf.d\n\n...I!\nLoaded\ninputs:\nswap\nsystem\ncpu\ndisk\ndiskio\nkernel\nmem\nprocesses\n...I!\nLoaded\noutputs:\nhttp\nprometheus_client\n...I!\n[\nagent\n]\nConfig:\nInterval:10s,\nQuiet:false,\nHostname:\n\"workload\"\n,\nFlush\nInterval:10s\n...I!\n[\noutputs.prometheus_client\n]\nListening\non\nhttp://127.0.0.1:9273/metrics\nVerify that it is collecting metrics by connecting to Telegraf’s web interface:\nworkload:~#\nwget\n-O-\nhttp://workload:9273/metrics\n# HELP cpu_usage_guest Telegraf collected metric\n# TYPE cpu_usage_guest gauge\ncpu_usage_guest\n{\ncpu\n=\n\"cpu-total\"\n,host\n=\n\"workload\"\n}\n0\ncpu_usage_guest\n{\ncpu\n=\n\"cpu0\"\n,host\n=\n\"workload\"\n}\n0\ncpu_usage_guest\n{\ncpu\n=\n\"cpu1\"\n,host\n=\n\"workload\"\n}\n0\ncpu_usage_guest\n{\ncpu\n=\n\"cpu10\"\n,host\n=\n\"workload\"\n}\n0\n...\ncpu_usage_idle\n{\ncpu\n=\n\"cpu-total\"\n,host\n=\n\"workload\"\n}\n92\n.74914376428686\ncpu_usage_idle\n{\ncpu\n=\n\"cpu0\"\n,host\n=\n\"workload\"\n}\n86\n.72897196325539\ncpu_usage_idle\n{\ncpu\n=\n\"cpu1\"\n,host\n=\n\"workload\"\n}\n90\n.11857707405758\ncpu_usage_idle\n{\ncpu\n=\n\"cpu10\"\n,host\n=\n\"workload\"\n}\n95\n.95141700494543\nSet up the Monitor node\n¶\nNow let’s create the Monitor. As before, we’ll be using LXD as the container technology but feel free to adapt these steps to your chosen alternative:\n$\nlxc\nlaunch\nubuntu:20.10\nmonitor\nCreating\nmonitor\nStarting\nmonitor\n$\nlxc\nexec\nmonitor\n--\nbash\nmonitor:~#\nMake a note of the newly created container’s IP address, which we’ll need later on;\nmonitor:~#\nip\naddr\n|\ngrep\n'inet .* global'\ninet\n10\n.69.244.104/24\nbrd\n10\n.69.244.255\nscope\nglobal\ndynamic\neth0\nVerify the Workload’s Telegraf instance can be reached from the Monitor:\nmonitor:~#\nwget\n-O-\nhttp://workload:9273/metrics\nWe’ll be setting up a few components to run on this node using their respective Snap packages. LXD images should normally have snap pre-installed, but if not, install it manually:\nmonitor:~#\napt\ninstall\nsnapd\nInstall Prometheus\n¶\nPrometheus will be our data manager. It collects data from external sources – Telegraf in our case – and distributes it to various destinations such as email/pager alerts, web UIs, API clients, remote storage services, etc. We’ll get into those shortly.\nLet’s install Prometheus itself, and the Prometheus Alertmanager plugin for alerts, along with the required dependencies:\nmonitor:~#\nsnap\ninstall\nprometheus\nmonitor:~#\nsnap\ninstall\nprometheus-alertmanager\nThe snap will automatically configure and start the service. To verify this, run:\nmonitor:~#\nsnap\nservices\nService\nStartup\nCurrent\nNotes\nlxd.activate\nenabled\ninactive\n-\nlxd.daemon\nenabled\ninactive\nsocket-activated\nprometheus.prometheus\nenabled\nactive\n-\nprometheus-alertmanager.alertmanager\nenabled\nactive\n-\nVerify that Prometheus is listening on the port as we expect:\nvisualizer:~#\nss\n-tulpn\n|\ngrep\nprometheus\ntcp\nLISTEN\n0\n128\n*:9090\n*:*\nusers:\n((\n\"prometheus\"\n,pid\n=\n618\n,fd\n=\n8\n))\njournalctl\ncan be also used to review the state of Snap services if more detail is needed. For example, to see where Prometheus is loading its config from:\nmonitor:~#\njournalctl\n|\ngrep\n\"prometheus.*config\"\n...\n...msg\n=\n\"Completed loading of configuration file\"\nfilename\n=\n/var/snap/prometheus/32/prometheus.yml\nAlthough the file name points to a specific Snap revision (\n32\n, in this case), we can use the generic config file\n/var/snap/prometheus/current/prometheus.yml\nhere in order to make things more general. Edit this config file to register the targets we’ll be reading data from. This will go under the\nscrape_configs\nsection of the file:\nscrape_configs:\n  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: 'prometheus'\n\n\t# metrics_path defaults to '/metrics'\n\t# scheme defaults to 'http'.\n\n\tstatic_configs:\n\t- targets: ['localhost:9090']\n\n  - job_name: 'telegraf'\n\tstatic_configs:\n\t- targets: ['workload:9273']\nThen restart Prometheus:\nmonitor:~#\nsnap\nrestart\nprometheus\nWhile we’ll be using Grafana for visualization, Prometheus also has a web interface for viewing and interacting with the collected data. At this stage, we can load it to verify that our setup is working properly. In a web browser, navigate to the Monitor’s IP address, and port\n9090\n. You should see Prometheus’ interface, as in the following image:\nIn the entry box, enter\ncpu_usage_system\n, select the “Graph” tab and click “Execute”. This should show a graph of our collected CPU data so far. Prometheus also has a secondary web UI using\nReact.js\n.\nConfigure Alertmanager\n¶\nLet’s tackle the Alert Manager next. Edit\n/var/snap/prometheus/current/prometheus.yml\nagain, adding the following to the\nalerting\nand\nrules_files\nsections:\n## /var/snap/prometheus/current/prometheus.yml\n#...\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n  - static_configs:\n\t- targets:\n\t  - 127.0.0.1:9093\nrule_files:\n  - 'alerts.yml'\nNow create\n/var/snap/prometheus/current/alerts.yml\nwith the following contents:\n## /var/snap/prometheus/current/alerts.yml\ngroups:\n- name: demo-alerts\n  rules:\n  - alert: HighLoad\n\texpr: node_load1 > 2.0\n\tfor: 60m\n\tlabels:\n\t  severity: normal\n\tannotations:\n\t  description: '{{ $labels.instance }} of job {{ $labels.job }} is under high load.'\n\t  summary: Instance {{ $labels.instance }} under high load.\n\t  value: '{{ $value }}'\n\n  - alert: InstanceDown\n\texpr: up == 0\n\tfor: 5m\n\tlabels:\n\t  severity: major\n\tannotations:\n\t  summary: \"Instance {{ $labels.instance }} down\"\n\t  description: \"{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.\"\nThis adds two alerts: one for high processor load, and one to report if the node has been unreachable for over 5 minutes. We’re considering high CPU to be a load of 2 or higher for an hour; this would need to be set to something more sensible for the style of workloads your production system experiences.\nWith the alerts themselves now defined, we next need to instruct Alertmanager how to handle them. There is a sample configuration installed to\n/var/snap/prometheus-alertmanager/current/alertmanager.yml\n, however it’s full of example data. Instead, replace it entirely with this content:\n## /var/snap/prometheus-alertmanager/current/alertmanager.yml\nglobal:\n  resolve_timeout: 5m\n\nroute:\n  group_by: ['alertname']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 1h\n\ninhibit_rules:\n  - source_match:\n\t  severity: 'critical'\n\ttarget_match:\n\t  severity: 'warning'\n\tequal: ['alertname', 'dev', 'instance']\nRestart Alertmanager after making the configuration change:\nworkload:~#\nsnap\nrestart\nprometheus-alertmanager\nInstall Grafana\n¶\nGrafana provides our main dashboard, from which we can generate graphs and other visuals to study the collected metrics. Grafana can read its data directly from log files, but we’ll focus on using Prometheus as its principle data source. Grafana is available as a Snap and can be installed like this:\nmonitor:~#\nsnap\ninstall\ngrafana\ngrafana\n6\n.7.4\nfrom\nAlvaro\nUría\n(\naluria\n)\ninstalled\nIt uses port\n3000\n:\n# ss -tulpn | grep grafana\ntcp\nLISTEN\n0\n128\n*:3000\n*:*\nusers:\n((\n\"grafana-server\"\n,pid\n=\n1449\n,fd\n=\n10\n))\nWe next need to know where it expects its configuration:\nmonitor:~#\njournalctl\n|\ngrep\n\"grafana.*conf\"\n...\nmsg\n=\n\"Config loaded from\"\nlogger\n=\nsettings\nfile\n=\n/snap/grafana/36/conf/defaults.ini\n...\nmsg\n=\n\"Config overridden from Environment variable\"\nlogger\n=\nsettings\nvar\n=\n\"GF_PATHS_PROVISIONING=/var/snap/grafana/common/conf/provisioning\"\n...\nerror\n=\n\"open /var/snap/grafana/common/conf/provisioning/datasources: no such file or directory\"\n...\nWe can see it is getting its defaults from\n/snap/grafana/36/conf/\n, but\n/snap/\nis a read-only directory and therefore we cannot edit the file. Instead, we should put our customisations inside\n/var/snap/grafana/36/conf/grafana.ini\n. You can also use the generic path\n/var/snap/grafana/current/conf/grafana.ini\n.\nFor a production installation, the\ndefaults.ini\nhas numerous parameters we’d want to customize for our site, however for the demo we’ll accept all the defaults. We do need to configure our data sources, but can do this via the web interface:\n$\nfirefox\nhttp://10.69.244.104:3000\nLog in with ‘admin’ and ‘admin’ as the username and password. This should bring you to the main Grafana page, where you can find links to tutorials and documentation. Delete any example data sources and/or dashboards.\nSelect the button to add a new data source and select “Prometheus”. On the “Data Sources / Prometheus” edit page, set:\nthe name to Prometheus\nthe URL to\nhttp://localhost:9090\n‘Access’ to “Server (default)” to make Grafana pull data from the Prometheus service we set up.\nThe remaining settings can be left as defaults. Click “Save & Test”.\nReturning to the Grafana home page, next set up a “New Dashboard”. A dashboard can hold one or more panels, each of which can be connected to one or more data queries. Let’s add a panel for CPU data. For the query, enter “cpu_usage_system” in the Metrics field.\nOn the left you can see four buttons to configure four elements of the panel: data source, visualization, general settings, and alerts. The general settings page allows us to set a title for the panel, for instance. Make any other customizations you want, and then save the dashboard using the save icon at the top of the page.\nUsing the same procedure, add additional panels for processor load and memory usage. Panels can be used to present other types of data as well, such as numerical indicators, logs, newsfeeds, or markdown-formatted documentation. For example, you can add a panel to display the system uptime, such as in the following image:\nTry also adding a panel with the “Text” visualization option for entering descriptive text about our demo. Save, and then view the final dashboard:", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:23Z", "original_len_words": 2199}}
{"id": "b8c3a0dcb8", "source_url": "https://documentation.ubuntu.com/server/how-to/observability/use-nagios-with-munin/", "title": "How to use Nagios with Munin - Ubuntu Server documentation", "text": "How to use Nagios with Munin - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to use Nagios with Munin\n¶\nNote\nNagios Core 3 has been deprecated and is now replaced by Nagios Core 4. The\nnagios3\npackage was last supported in Bionic, so subsequent releases should use\nnagios4\ninstead.\nThe monitoring of essential servers and services is an important part of system administration. Most network services are monitored for performance, availability, or both. This section will cover installation and configuration of Nagios 3 for availability monitoring alongside Munin for performance monitoring.\nThe examples in this section will use two servers with hostnames\nserver01\nand\nserver02\n.\nServer01\nwill be configured with Nagios 3 to monitor services on both itself and\nserver02\n.\nServer01\nwill also be set up with the Munin package to gather information from the network. Using the\nmunin-node\npackage,\nserver02\nwill be configured to send information to\nserver01\n.\nInstall Nagios 3\n¶\nOn server01\n¶\nFirst, on\nserver01\n, install the\nnagios3\npackage. In a terminal, enter:\nsudo\napt\ninstall\nnagios3\nnagios-nrpe-plugin\nYou will be asked to enter a password for the\nnagiosadmin\nuser. The user’s credentials are stored in\n/etc/nagios3/htpasswd.users\n. To change the\nnagiosadmin\npassword, or add additional users to the Nagios CGI scripts, use the\nhtpasswd\nthat is part of the\napache2-utils\npackage.\nFor example, to change the password for the\nnagiosadmin\nuser enter:\nsudo\nhtpasswd\n/etc/nagios3/htpasswd.users\nnagiosadmin\nTo add a user:\nsudo\nhtpasswd\n/etc/nagios3/htpasswd.users\nsteve\nOn server02\n¶\nNext, on\nserver02\ninstall the\nnagios-nrpe-server\npackage. From a terminal on\nserver02\n, enter:\nsudo\napt\ninstall\nnagios-nrpe-server\nNote\nNRPE allows you to run local checks on remote hosts. There are other ways of accomplishing this, including through other Nagios plugins.\nConfiguration overview\n¶\nThere are a few directories containing Nagios configuration and check files.\n/etc/nagios3\n: contains configuration files for the operation of the Nagios daemon, CGI files, hosts, etc.\n/etc/nagios-plugins\n: houses configuration files for the service checks.\n/etc/nagios\n: is located on the remote host and contains the\nnagios-nrpe-server\nconfiguration files.\n/usr/lib/nagios/plugins/\n: where the check binaries are stored. To see the options of a check use the\n-h\noption.\nFor example:\n/usr/lib/nagios/plugins/check_dhcp\n-h\nThere are many checks Nagios can be configured to run for any particular host. In this example, Nagios will be configured to check disk space,\nDNS\n, and a MySQL\nhost group\n. The DNS check will be on\nserver02\n, and the MySQL host group will include both\nserver01\nand\nserver02\n.\nNote\nSee these additional guides for details on setting up\nApache\n,\nDomain Name Service (DNS)\n, and\nMySQL\n.\nAdditionally, there are some terms that once explained will hopefully make understanding Nagios configuration easier:\nHost\n: a server, workstation, network device, etc that is being monitored.\nHost group\n: a group of similar hosts. For example, you could group all web servers, file servers, etc.\nService\n: the service being monitored on the host, such as HTTP, DNS, NFS, etc.\nService group\n: allows you to group multiple services together. This is useful for grouping, e.g.,  multiple HTTP.\nContact\n: the person to be notified when an event takes place. Nagios can be configured to send emails, SMS messages, etc.\nBy default Nagios is configured to check HTTP, disk space, SSH, current users, processes, and load on the\nlocalhost\n. Nagios will also ping-check the\ngateway\n.\nLarge Nagios installations can be quite complex to configure. It is usually best to start small (i.e. with one or two hosts), get things configured the way you like, and then expand.\nConfigure Nagios\n¶\nFirst, create a\nhost\nconfiguration file for\nserver02\n. Unless otherwise specified, run all these commands on\nserver01\n. In a terminal enter:\nsudo\ncp\n/etc/nagios3/conf.d/localhost_nagios2.cfg\n\\\n/etc/nagios3/conf.d/server02.cfg\nNote\nIn the above and following command examples, replace “\nserver01\n”, “\nserver02\n”,\n172.18.100.100\n, and\n172.18.100.101\nwith the host names and IP addresses of your servers.\nNext, edit\n/etc/nagios3/conf.d/server02.cfg\n:\ndefine host{\n        use                     generic-host  ; Name of host template to use\n        host_name               server02\n        alias                   Server 02\n        address                 172.18.100.101\n}\n        \n# check DNS service.\ndefine service {\n        use                             generic-service\n        host_name                       server02\n        service_description             DNS\n        check_command                   check_dns!172.18.100.101\n}\nRestart the Nagios daemon to enable the new configuration:\nsudo\nsystemctl\nrestart\nnagio3.service\nNow add a service definition for the MySQL check by adding the following to\n/etc/nagios3/conf.d/services_nagios2.cfg\n:\n# check MySQL servers.\ndefine service {\n        hostgroup_name        mysql-servers\n        service_description   MySQL\n        check_command         check_mysql_cmdlinecred!nagios!secret!$HOSTADDRESS\n        use                   generic-service\n        notification_interval 0 ; set > 0 if you want to be renotified\n}\nA\nmysql-servers\nhost group now needs to be defined. Edit\n/etc/nagios3/conf.d/hostgroups_nagios2.cfg\nadding:\n# MySQL hostgroup.\ndefine hostgroup {\n        hostgroup_name  mysql-servers\n                alias           MySQL servers\n                members         localhost, server02\n}\n\nThe Nagios check needs to authenticate to MySQL. To add a `nagios` user to MySQL, enter:\n\n```bash\nmysql -u root -p -e \"create user nagios identified by 'secret';\"\n    \n```{note}\nThe `nagios` user will need to be added all hosts in the `mysql-servers` host group.\nRestart Nagios to start checking the MySQL servers.\nsudo\nsystemctl\nrestart\nnagios3.service\nLastly, configure NRPE to check the disk space on\nserver02\n. On\nserver01\nadd the service check to\n/etc/nagios3/conf.d/server02.cfg\n:\n# NRPE disk check.\ndefine service {\n        use                     generic-service\n        host_name               server02\n        service_description     nrpe-disk\n        check_command           check_nrpe_1arg!check_all_disks!172.18.100.101\n}\nNow on\nserver02\nedit\n/etc/nagios/nrpe.cfg\n, changing:\nallowed_hosts=172.18.100.100\nAnd below in the command definition area add:\ncommand[check_all_disks]=/usr/lib/nagios/plugins/check_disk -w 20% -c 10% -e\nFinally, restart\nnagios-nrpe-server\n:\nsudo\nsystemctl\nrestart\nnagios-nrpe-server.service\nAlso, on\nserver01\nrestart\nnagios3\n:\nsudo\nsystemctl\nrestart\nnagios3.service\nYou should now be able to see the host and service checks in the Nagios CGI files. To access them, point a browser to\nhttp://server01/nagios3\n. You will then be prompted for the\nnagiosadmin\nusername and password.\nInstall Munin\n¶\nBefore installing Munin on\nserver01\nApache2 will need to be installed. The default configuration is fine for running a Munin server. For more information see\nsetting up Apache\n.\nOn server01\n¶\nFirst, on\nserver01\ninstall\nmunin\nby running the following command in a terminal:\nsudo\napt\ninstall\nmunin\nOn server02\n¶\nNow on\nserver02\ninstall the\nmunin-node\npackage:\nsudo\napt\ninstall\nmunin-node\nConfigure Munin on server01\n¶\nOn\nserver01\nedit the\n/etc/munin/munin.conf\nto add the IP address for\nserver02\n:\n## First our \"normal\" host.\n[server02]\n       address 172.18.100.101\nNote\nReplace\nserver02\nand\n172.18.100.101\nwith the actual hostname and IP address of your server.\nConfigure munin-node on server02\n¶\nTo configure\nmunin-node\non\nserver02\n, edit\n/etc/munin/munin-node.conf\nto allow access by\nserver01\n:\nallow ^172\\.18\\.100\\.100$\nNote\nReplace\n^172\\.18\\.100\\.100$\nwith IP address for your Munin server.\nNow restart\nmunin-node\non\nserver02\nfor the changes to take effect:\nsudo\nsystemctl\nrestart\nmunin-node.service\nFinally, in a browser go to\nhttp://server01/munin\n, and you should see links to some graphs displaying information from the standard\nmunin-plugins\nfor disk, network, processes, and system.\nNote\nSince this is a new install it may take some time for the graphs to display anything useful.\nAdditional plugins\n¶\nThe\nmunin-plugins-extra\npackage contains performance checks and additional services such as DNS,\nDHCP\n, Samba, etc. To install the package, from a terminal enter:\nsudo\napt\ninstall\nmunin-plugins-extra\nBe sure to install the package on both the server and node machines.\nFurther reading\n¶\nSee the\nMunin\nand\nNagios\nwebsites for more details on these packages.\nThe\nMunin Documentation\npage includes information on additional plugins, writing plugins, etc.\nThe\nNagios Online Documentation\nsite.\nThere is also a\nlist of books\nrelated to Nagios and network monitoring.\nThe\nNagios Ubuntu Wiki\npage also has more details.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:24Z", "original_len_words": 1270}}
{"id": "23dd561209", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/", "title": "OpenLDAP - Ubuntu Server documentation", "text": "OpenLDAP - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nOpenLDAP\n¶\nThe Lightweight Directory Access Protocol, or LDAP, is a protocol for managing hierarchical data and accessing directories. The open source implementation used in Ubuntu is OpenLDAP.\nThese guides are intended to be sequential, so following them in the order presented below is suggested.\nInstall OpenLDAP\nSet up access control\nOpenLDAP with replication\nUser and group management\nOpenLDAP and TLS\nBackup and restore\nIntroduction to passthrough authentication\nPassthrough authentication with Kerberos\nSee also\n¶\nHow-to:\nHow to set up SSSD with LDAP\nExplanation:\nIntroduction to OpenLDAP", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:24Z", "original_len_words": 118}}
{"id": "d571c0b4c1", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/access-control/", "title": "Set up LDAP access control - Ubuntu Server documentation", "text": "Set up LDAP access control - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nSet up LDAP access control\n¶\nThe management of what type of access (read, write, etc) users should be granted for resources is known as\naccess control\n. The configuration directives involved are called\naccess control lists\nor\nACL\ns.\nWhen we\ninstalled the slapd package\n, various ACLs were set up automatically. We will look at a few important consequences of those defaults and, in so doing, we’ll get an idea of how ACLs work and how they’re configured.\nTo get the effective ACL for an LDAP query we need to look at the ACL entries of both the database being queried, and those of the special\nfrontend\ndatabase instance. Note that the ACLs belonging to the frontend database are always appended to the database-specific ACLs, and the first match ‘wins’.\nGetting the ACLs\n¶\nThe following commands will give, respectively, the ACLs of the\nmdb\ndatabase (\ndc=example,dc=com\n) and those of the frontend database:\n$\nsudo\nldapsearch\n-Q\n-LLL\n-Y\nEXTERNAL\n-H\nldapi:///\n-b\n\\\ncn\n=\nconfig\n'(olcDatabase={1}mdb)'\nolcAccess\ndn:\nolcDatabase\n={\n1\n}\nmdb,cn\n=\nconfig\nolcAccess:\n{\n0\n}\nto\nattrs\n=\nuserPassword\nby\nself\nwrite\nby\nanonymous\nauth\nby\n*\nnone\nolcAccess:\n{\n1\n}\nto\nattrs\n=\nshadowLastChange\nby\nself\nwrite\nby\n*\nread\nolcAccess:\n{\n2\n}\nto\n*\nby\n*\nread\n$\nsudo\nldapsearch\n-Q\n-LLL\n-Y\nEXTERNAL\n-H\nldapi:///\n-b\n\\\ncn\n=\nconfig\n'(olcDatabase={-1}frontend)'\nolcAccess\ndn:\nolcDatabase\n={\n-1\n}\nfrontend,cn\n=\nconfig\nolcAccess:\n{\n0\n}\nto\n*\nby\ndn.exact\n=\ngidNumber\n=\n0\n+uidNumber\n=\n0\n,cn\n=\npeercred,cn\n=\nexternal\n,cn\n=\nauth\nmanage\nby\n*\nbreak\nolcAccess:\n{\n1\n}\nto\ndn.exact\n=\n\"\"\nby\n*\nread\nolcAccess:\n{\n2\n}\nto\ndn.base\n=\n\"cn=Subschema\"\nby\n*\nread\nNote\nThe Root\nDN\nalways has full rights to its database and does not need to be included in any ACL.\nInterpreting the results\n¶\nThe first two ACLs are crucial:\nolcAccess: {0}to attrs=userPassword by self write by anonymous auth by * none\nolcAccess: {1}to attrs=shadowLastChange by self write by * read\nThis can be represented differently for easier reading:\nto attrs=userPassword\n    by self write\n    by anonymous auth\n    by * none\n    \nto attrs=shadowLastChange\n    by self write\n    by * read\nThese ACLs enforce the following:\nAnonymous ‘auth’ access is provided to the\nuserPassword\nattribute so that users can authenticate, or\nbind\n. Perhaps counter-intuitively, ‘by anonymous auth’ is needed even when anonymous access to the\nDIT\nis unwanted, otherwise this would be a chicken-and-egg problem: before authentication, all users are anonymous.\nThe ‘by self write’ ACL grants write access to the\nuserPassword\nattribute to users who authenticated as the DN where the attribute lives. In other words, users can update the\nuserPassword\nattribute of their own entries.\nThe\nuserPassword\nattribute is otherwise inaccessible by all other users, with the exception of the Root DN, who always has access and doesn’t need to be mentioned explicitly.\nIn order for users to change their own password, using\npasswd\nor other utilities, the user’s own\nshadowLastChange\nattribute needs to be writable. All other directory users get to read this attribute’s contents.\nThis DIT can be searched anonymously because of\nto\n*\nby\n*\nread\nin this ACL, which grants read access to everything else, by anyone (including anonymous):\nto *\n    by * read\nIf this is unwanted then you need to change the ACL. To force authentication during a bind request you can alternatively (or in combination with the modified ACL) use the\nolcRequire:\nauthc\ndirective.\nSASL identity\n¶\nThere is no administrative account (“Root DN”) created for the\nslapd-config\ndatabase. There is, however, a SASL identity that is granted full access to it. It represents the localhost’s superuser (\nroot\n/\nsudo\n). Here it is:\ndn.exact=gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nThe following command will display the ACLs of the\nslapd-config\ndatabase:\n$\nsudo\nldapsearch\n-Q\n-LLL\n-Y\nEXTERNAL\n-H\nldapi:///\n-b\n\\\ncn\n=\nconfig\n'(olcDatabase={0}config)'\nolcAccess\ndn:\nolcDatabase\n={\n0\n}\nconfig,cn\n=\nconfig\nolcAccess:\n{\n0\n}\nto\n*\nby\ndn.exact\n=\ngidNumber\n=\n0\n+uidNumber\n=\n0\n,cn\n=\npeercred,\ncn\n=\nexternal,cn\n=\nauth\nmanage\nby\n*\nbreak\nSince this is a SASL identity we need to use a SASL\nmechanism\nwhen invoking the LDAP utility in question – the\nEXTERNAL\nmechanism (see the previous command for an example). Note that:\nYou must use\nsudo\nto become the root identity in order for the ACL to match.\nThe EXTERNAL mechanism works via\nInterprocess Communication\n(IPC, UNIX domain sockets). This means you must use the\nldapi\nURI format.\nA succinct way to get all the ACLs is like this:\n$\nsudo\nldapsearch\n-Q\n-LLL\n-Y\nEXTERNAL\n-H\nldapi:///\n-b\n\\\ncn\n=\nconfig\n'(olcAccess=*)'\nolcAccess\nolcSuffix\nNext steps\n¶\nSee how to\nset up LDAP users and groups\n.\nFurther reading\n¶\nSee the manual page for\nslapd.access(5)\nThe\naccess control topic\nin the OpenLDAP administrator’s guide.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:24Z", "original_len_words": 853}}
{"id": "f2d527da0b", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/backup-and-restore/", "title": "Backup and restore OpenLDAP - Ubuntu Server documentation", "text": "Backup and restore OpenLDAP - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nBackup and restore OpenLDAP\n¶\nNow we have LDAP running just the way we want, it is time to ensure we can save all of our work and restore it as needed.\nWhat we need is a way to back up the directory database(s) – specifically the configuration backend (\ncn=config\n) and the\nDIT\n(\ndc=example,dc=com\n). If we are going to backup those databases into, say,\n/export/backup\n, we could use\nslapcat\nas shown in the following script, called\n/usr/local/bin/ldapbackup\n:\n#!/bin/bash\nset\n-e\nBACKUP_PATH\n=\n/export/backup\nSLAPCAT\n=\n/usr/sbin/slapcat\n\nnice\n${\nSLAPCAT\n}\n-b\ncn\n=\nconfig\n>\n${\nBACKUP_PATH\n}\n/config.ldif\nnice\n${\nSLAPCAT\n}\n-b\ndc\n=\nexample,dc\n=\ncom\n>\n${\nBACKUP_PATH\n}\n/example.com.ldif\nchown\nroot:root\n${\nBACKUP_PATH\n}\n/*\nchmod\n600\n${\nBACKUP_PATH\n}\n/*.ldif\nNote\nThese files are uncompressed text files containing everything in your directory including the tree layout, usernames, and every password. So, you might want to consider making\n/export/backup\nan encrypted partition and even having the script encrypt those files as it creates them. Ideally you should do both, but that depends on your security requirements.\nThen, it is just a matter of having a cron script to run this program as often as you feel comfortable with. For many, once a day suffices. For others, more often is required. Here is an example of a cron script called\n/etc/cron.d/ldapbackup\nthat is run every night at 22:45h:\nMAILTO=backup-emails@domain.com\n45 22 * * *  root    /usr/local/bin/ldapbackup\nNow the files are created, they should be copied to a backup server.\nAssuming we did a fresh reinstall of LDAP, the restore process could be something like this:\n#!/bin/bash\nset\n-e\nBACKUP_PATH\n=\n/export/backup\nSLAPADD\n=\n/usr/sbin/slapadd\nif\n[\n-n\n\"\n$(\nls\n-l\n/var/lib/ldap/*\n2\n>/dev/null\n)\n\"\n-o\n-n\n\"\n$(\nls\n-l\n/etc/ldap/slapd.d/*\n2\n>/dev/null\n)\n\"\n]\n;\nthen\necho\nRun\nthe\nfollowing\nto\nremove\nthe\nexisting\ndb:\necho\nsudo\nsystemctl\nstop\nslapd.service\necho\nsudo\nrm\n-rf\n/etc/ldap/slapd.d/*\n/var/lib/ldap/*\nexit\n1\nfi\nsudo\nsystemctl\nstop\nslapd.service\n||\n:\nsudo\nslapadd\n-F\n/etc/ldap/slapd.d\n-b\ncn\n=\nconfig\n-l\n/export/backup/config.ldif\nsudo\nslapadd\n-F\n/etc/ldap/slapd.d\n-b\ndc\n=\nexample,dc\n=\ncom\n-l\n/export/backup/example.com.ldif\nsudo\nchown\n-R\nopenldap:openldap\n/etc/ldap/slapd.d/\nsudo\nchown\n-R\nopenldap:openldap\n/var/lib/ldap/\nsudo\nsystemctl\nstart\nslapd.service\nThis is a simplistic backup strategy, of course. It’s being shown here as a reference for the basic tooling you can use for backups and restores.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:24Z", "original_len_words": 435}}
{"id": "639daa80c9", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/install-openldap/", "title": "Install and configure LDAP - Ubuntu Server documentation", "text": "Install and configure LDAP - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nInstall and configure LDAP\n¶\nLightweight Directory Access Protocol\n(LDAP) is a protocol used for managing hierarchical data. OpenLDAP is the open-source implementation of LDAP used in Ubuntu. For information about OpenLDAP and explanations of the key terminology, see\nIntroduction to OpenLDAP\n.\nInstalling\nslapd (the Stand-alone LDAP Daemon)\ncreates a minimal working configuration with a top level entry, and an administrator’s Distinguished Name (DN).\nIn particular, it creates a database instance that you can use to store your data. However, the\nsuffix\n(or\nbase DN\n) of this instance will be determined from the domain name of the host. If you want something different, you can change it right after the installation (before it contains any useful data).\nNote\nThis guide will use a database suffix of\ndc=example,dc=com\n. You can change this to match your particular setup.\nInstall slapd\n¶\nYou can install the server and the main command line utilities with the following command:\nsudo apt install slapd ldap-utils\nChange the instance suffix (optional)\n¶\nIf you want to change your Directory Information Tree (\nDIT\n) suffix, now would be a good time since changing it discards your existing one. To change the suffix, run the following command:\nsudo dpkg-reconfigure slapd\nTo switch your DIT suffix to\ndc=example,dc=com\n, for example, so you can follow this guide more closely, answer\nexample.com\nwhen asked about the\nDNS\ndomain name.\nThroughout this guide we will issue many commands with the LDAP utilities. To save some typing, we can configure the OpenLDAP libraries with certain defaults in\n/etc/ldap/ldap.conf\n(adjust these entries for your server name and directory suffix):\nBASE dc=example,dc=com\nURI ldap://ldap01.example.com\nDefault tree contents\n¶\nslapd\nis designed to be configured within the service itself by dedicating a separate DIT for that purpose. This allows for dynamic configuration of\nslapd\nwithout needing to restart the service or edit config files. This configuration database consists of a collection of text-based LDIF files located under\n/etc/ldap/slapd.d\n, but these should never be edited directly. This way of working is known by several names: the “slapd-config” method, the “Real Time Configuration (RTC)” method, or the “cn=config” method. You can still use the traditional flat-file method (\nslapd.conf\n) but that will not be covered in this guide.\nRight after installation, you will get two databases, or suffixes: one for your data, which is based on your host’s domain (\ndc=example,dc=com\n), and one for your configuration, with its root at\ncn=config\n. To change the data on each we need different credentials and access methods:\ndc=example,dc=com\nThe administrative user for this suffix is\ncn=admin,dc=example,dc=com\nand its password is the one selected during the installation of the\nslapd\npackage.\ncn=config\nThe configuration of\nslapd\nitself is stored under this suffix. Reading and writing to it can be done by the special\nDN\ngidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\n. This is how the local system’s root user (\nuid=0/gid=0\n) is seen by the directory when using\nSASL\nEXTERNAL authentication through the\nldapi:///\ntransport via the\n/run/slapd/ldapi\nUnix socket. Essentially what this means is that only the local root user can update the\ncn=config\ndatabase. More details later.\nDefault configuration tree\n¶\nThis is what the\nslapd-config\nDIT looks like via the LDAP protocol (listing only the DNs):\nTo see what the\nslapd-config\nDIT looks like via the LDAP protocol, listing only the DNs, run this command:\nsudo ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config dn\nThe command-line options mean the following:\n-Q\n: Quiet mode for the SASL authentication setup.\n-LLL\n: Less verbose LDIF output. One “\nL\n” restricts output to LDIFv1; another disables comments; and the third one removes the LDIF version from the output.\n-Y\nEXTERNAL\n: Select the\nEXTERNAL\nSASL mechanism for authentication.\n-H\nldapi:///\n: The URL to use to contact the server. In this case, it will use a local unix socket.\n-b\ncn=config\n: Start the search at the\ncn=config\nbase.\ndn\n: Only retrieve the\ndn\nattribute.\nThe output will be the similar to the following:\ndn: cn=config\ndn: cn=module{0},cn=config\ndn: cn=schema,cn=config\ndn: cn={0}core,cn=schema,cn=config\ndn: cn={1}cosine,cn=schema,cn=config\ndn: cn={2}nis,cn=schema,cn=config\ndn: cn={3}inetorgperson,cn=schema,cn=config\ndn: olcDatabase={-1}frontend,cn=config\ndn: olcDatabase={0}config,cn=config\ndn: olcDatabase={1}mdb,cn=config\nWhere the entries mean the following:\ncn=config\n: Global settings\ncn=module{0},cn=config\n: A dynamically loaded module\ncn=schema,cn=config\n: Contains hard-coded system-level schema\ncn={0}core,cn=schema,cn=config\n: The hard-coded\ncore\nschema\ncn={1}cosine,cn=schema,cn=config\n: The Cosine schema\ncn={2}nis,cn=schema,cn=config\n: The Network Information Services (NIS) schema\ncn={3}inetorgperson,cn=schema,cn=config\n: The InetOrgPerson schema\nolcDatabase={-1}frontend,cn=config\n:\nFrontend\ndatabase, default settings for other databases\nolcDatabase={0}config,cn=config\n:\nslapd\nconfiguration database (\ncn=config\n)\nolcDatabase={1}mdb,cn=config\n: Your database instance (\ndc=example,dc=com\n)\nSince the configuration is located under the\ncn=config\nsuffix, we can use LDAP commands to inspect or modify it.\nTo see all the configuration, run this command:\nsudo ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config\nThe output is too large to show here, but it will start like this:\ndn: cn=config\nobjectClass: olcGlobal\ncn: config\nolcArgsFile: /var/run/slapd/slapd.args\nolcLogLevel: none\n...\nDefault “data” tree\n¶\nAfter installing the\nslapd\npackage, a default data tree is configured, based on the detected domain name of the system. Assuming a domain of\nexample.com\n, this command can be run to show what it looks like:\nldapsearch -x -LLL -H ldap:/// -b dc=example,dc=com dn\nHere the only new command-line option is\n-x\n, and we have a new parameter for\n-H\n:\n-x\n: Use simple authentication instead of SASL, which is essentially a plain text authentication. Since no\nBind DN\nwas provided (via\n-D\n), this becomes an\nanonymous\nbind. Without\n-x\n, the default is to use a SASL bind.\n-H\nldap:///\n: Use the LDAP protocol over the network (and not over a unix socket), and since no hostname was provided, it’s assumed to be localhost. To access a server on another host, one would use\nldap://server.example.com/\nas the URL, for example.\nThe output will be the top-level entry which represents the base of the DIT.\ndn: dc=example,dc=com\nWho am I?\n¶\nA very handy tool to verify the authentication is\nldapwhoami\n, which can be used as follows:\nldapwhoami -x\nThe output will say who we connected as:\nanonymous\nNow let’s perform an authenticated call, via simple authentication:\nldapwhoami -x -D cn=admin,dc=example,dc=com -W\nThis time we will be shown our authentication DN, after the password prompt:\nEnter LDAP Password:\ndn:cn=admin,dc=example,dc=com\nWhen you use simple bind (\n-x\n) and specify a Bind DN with\n-D\nas your authentication DN, the server will look for a\nuserPassword\nattribute in the entry, and use that to verify the credentials. In this particular case above, we used the database\nRoot DN\nentry, i.e., the actual administrator, and that is a special case whose password is set in the configuration when the package is installed.\nNote\nA simple bind without some sort of transport security mechanism is\nclear text\n, meaning the credentials are transmitted in the clear. You should\nadd Transport Layer Security (TLS) support\nto your OpenLDAP server as soon as possible.\nLet’s try some SASL EXTERNAL authentication commands:\nldapwhoami -Y EXTERNAL -H ldapi:/// -Q\nThe authentication DN is quite different from the simple bind one from before:\ndn:gidNumber=1000+uidNumber=1000,cn=peercred,cn=external,cn=auth\nLet’s try as root:\nsudo ldapwhoami -Y EXTERNAL -H ldapi:/// -Q\nNotice how the\nuidNumber\nand\ngidNumber\nchanged:\ndn:gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nWhen using SASL EXTERNAL via the\nldapi:///\ntransport, the Bind DN becomes a combination of the\nuid\nand\ngid\nof the connecting user, followed by the suffix\ncn=peercred,cn=external,cn=auth\n. The server ACLs know about this, and grant the local root user complete write access to\ncn=config\nvia the SASL mechanism.\nNote\nOpenLDAP ACLs are explained in\nSet up access control\nPopulate the directory\n¶\nLet’s introduce some content to our directory. We will add the following:\nA node called\nPeople\n, to store users\nAn entry for a user called\njohn\nA node called\nGroups\n, to store groups\nAn entry for a group called\nminers\nCreate the following LDIF file and call it\nadd_content.ldif\n:\ndn: ou=People,dc=example,dc=com\nobjectClass: organizationalUnit\nou: People\n\ndn: ou=Groups,dc=example,dc=com\nobjectClass: organizationalUnit\nou: Groups\n\ndn: cn=miners,ou=Groups,dc=example,dc=com\nobjectClass: posixGroup\ncn: miners\ngidNumber: 5000\nmemberUid: john\n\ndn: uid=john,ou=People,dc=example,dc=com\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: shadowAccount\nuid: john\nsn: Doe\ngivenName: John\ncn: John Doe\ndisplayName: John Doe\nuidNumber: 10000\ngidNumber: 5000\nuserPassword: {CRYPT}x\ngecos: John Doe\nloginShell: /bin/bash\nhomeDirectory: /home/john\nNote\nIt’s important that\nuid\nand\ngid\nvalues in your directory do not collide with local Linux users’ values as defined in\n/etc/passwd\nand\n/etc/group\n. You can use higher number ranges, such as starting at 5000 or even higher.\nAdd the content:\nldapadd -x -D cn=admin,dc=example,dc=com -W -f add_content.ldif\nThe command will ask for the admin password, and then show the entries as they are being added:\nEnter LDAP Password: ********\nadding new entry \"ou=People,dc=example,dc=com\"\n\nadding new entry \"ou=Groups,dc=example,dc=com\"\n\nadding new entry \"cn=miners,ou=Groups,dc=example,dc=com\"\n\nadding new entry \"uid=john,ou=People,dc=example,dc=com\"\nWe can check that the information has been correctly added with the\nldapsearch\nutility. For example, let’s search for the “john” entry, and request the\ncn\nand\ngidnumber\nattributes:\nldapsearch -x -LLL -b dc=example,dc=com '(uid=john)' cn gidNumber\nThe output shows the DNs that matched the search criteria, and the requested attributes:\ndn: uid=john,ou=People,dc=example,dc=com\ncn: John Doe\ngidNumber: 5000\nHere we used an LDAP “filter”:\n(uid=john)\n. LDAP filters are very flexible and can become complex. For example, to list the group names of which\njohn\nis a member, we could use the following command:\nldapsearch -x -LLL -b dc=example,dc=com '(&(objectClass=posixGroup)(memberUid=john))' cn gidNumber\nAnd the result tells us that “john” is a member of the “miners” group:\ndn: cn=miners,ou=Groups,dc=example,dc=com\ncn: miners\ngidNumber: 5000\nThat filter is a logical “AND” (signalled by the “\n&\n” character in the filter expression) between two attributes:\nobjectClass=posixGroup\nAND\nmemberUid=john\n. Filters are very important in LDAP and mastering their syntax is extremely helpful. They are used for simple queries like this, but can also select what content is to be replicated to a secondary server, or even in complex ACLs. The full specification is defined in\nRFC 4515\n.\nNotice we set the\nuserPassword\nfield for the “john” entry to the cryptic value\n{CRYPT}x\n. This essentially is an invalid password, because no hashing will produce just\nx\n. It’s a common pattern when adding a user entry without a default password. To change the password to something valid, you can now use\nldappasswd\n:\nldappasswd -x -D cn=admin,dc=example,dc=com -W -S uid=john,ou=people,dc=example,dc=com\nWe will be prompted for the new password twice, and at the end for the bind password corresponding to the bind DN specified via\n-D\n:\nNew password:\nRe-enter new password:\nEnter LDAP Password:\nTo verify the change, we can use\nldapwhoami\nwith simple bind authentication using john’s DN as the bind DN:\nldapwhoami -x -D uid=john,ou=people,dc=example,dc=com -W\nIf the new password worked, the output will show that we authenticated as the\nuid=john,ou=People,dc=example,dc=com\nDN:\nEnter LDAP Password:\ndn:uid=john,ou=People,dc=example,dc=com\nNote\nRemember that simple binds are insecure and you should\nadd TLS support\nto your server as soon as possible!\nChange the configuration\nThe\nslapd-config\nDIT can also be queried and modified. Here are some common operations.\nWhich “admin” DN to use?\n¶\nThroughout this guide so far, we have used two different authentication mechanisms to make changes to the directory. Which one is needed for what kind of change?\nEach directory tree suffix has its own specific administrative DN. This is the DN that can make changes to the tree and is not subject to ACLs. It is stored in the\nolcRootDN\nattribute under the\ncn=config\nconfiguration tree, and the corresponding password is in the\nolcRootPW\nattribute.\nBesides this specific administrator entry, ACLs can also grant such privileges to any other DN in the directory. All of this is setup by the\nslapd\npackage when it is installed. This results in the following DNs that can be used to make changes to each directory suffix:\nSuffix\nDN for making changes\nAuthentication mechanism\ncn=config\ncn=admin,cn=config\nabsent\ncn=config\ngidNumber=0+uidNumber=0,\ncn=peercred,cn=external,cn=auth\nSASL EXTERNAL as root via ldapi://\ndc=example,dc=com\ncn=admin,dc=example,dc=com\nSimple bind with password\nset during install or reconfigure\nChange the “admin” password\n¶\nThere is really only one administrative DN that has an associated password, and it’s the one created at install (or reconfigure) time. To locate it in the\ncn=config\nsuffix, run this command:\nsudo ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config '(olcSuffix=dc=example,dc=com)' olcSuffix olcRootDN olcRootPW\nThe output will be the configuration entry for the\ndc=example,dc=com\nsuffix, and show only the selected attributes in the response:\ndn: olcDatabase={1}mdb,cn=config\nolcSuffix: dc=example,dc=com\nolcRootDN: cn=admin,dc=example,dc=com\nolcRootPW: {SSHA}Y0UjBUUmf08TC25ePVc6waI/mfvPNktk\nSince the\nolcRootPW\npassword attribute we want to change is located under the\ncn=config\nsuffix, we will also have to use the SASL EXTERNAL authentication to modify it, according to the table shown earlier.\nNote\nEven though this\nolcRootDN\nis the administrative DN for the\ndc=example,dc=com\nsuffix, it is stored under the\ncn=config\nsuffix!\nTo change the password associated with the\nolcRootDN\nadministrative DN, we need to replace the value of the\nolcRootPW\nattribute. That value is not the literal password, but the hash of the password, using a specific hash algorithm.\nTo obtain the hash of a password, suitable to be used as the value of\nolcRootPW\n, run the\nslappasswd\ncommand and type the password you want, with a confirmation. The output will be the hash for that password, which we will need for the next step:\nNew password:\nRe-enter new password:\n{SSHA}VKrYMxlSKhONGRpC6rnASKNmXG2xHXFo\nNow prepare a\nchangerootpw.ldif\nfile with this content, which includes the hashed password from the output above:\ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: {SSHA}VKrYMxlSKhONGRpC6rnASKNmXG2xHXFo\nFinally, run the\nldapmodify\ncommand on this file:\nldapmodify -Q -Y EXTERNAL -H ldapi:/// -f changerootpw.ldif\nIf successful, the output will show the entry that is being modified:\nmodifying\nentry\n\"olcDatabase=\n{1}\nmdb,cn=config\"\nAdd an index\n¶\nLike in other database types, having an index for attributes commonly used in searches can speed up such searches dramatically, specially on large trees. The default installation of OpenLDAP already creates several common indexes, but depending on your data and queries, other indexes might be helpful.\nUse\nldapmodify\nto add an “Index” to your\n{1}mdb,cn=config\ndatabase definition (for\ndc=example,dc=com\n). In this example, we will add an “equality” and a “substring” index to the\nmail\nattribute. Create a file called\nadd_index.ldif\n, and add the following contents:\ndn: olcDatabase={1}mdb,cn=config\nadd: olcDbIndex\nolcDbIndex: mail eq,sub\nThen issue the command:\nsudo ldapmodify -Q -Y EXTERNAL -H ldapi:/// -f add_index.ldif\nThe output will show the modifications being done:\nmodifying entry \"olcDatabase={1}mdb,cn=config\"\nYou can confirm the change with a search:\nldapsearch -Q -LLL -Y EXTERNAL -H ldapi:/// -b cn=config '(olcDatabase={1}mdb)' olcDbIndex\nAnd the result will include all instances of the\nolcDbIndex\nattribute:\ndn: olcDatabase={1}mdb,cn=config\nolcDbIndex: objectClass eq\nolcDbIndex: cn,uid eq\nolcDbIndex: uidNumber,gidNumber eq\nolcDbIndex: member,memberUid eq\nolcDbIndex: mail eq,sub\nSee also\nTo learn more about OpenLDAP indexes, check the upstream documentation at\nhttps://www.openldap.org/doc/admin26/tuning.html#Indexes\nAdd a schema\n¶\nSchemas can only be added to\ncn=config\nif they are in LDIF format. If not, they will first have to be converted. You can find unconverted schemas in addition to converted ones in the\n/etc/ldap/schema\ndirectory.\nNote\nIt is not trivial to remove a schema from the slapd-config database. Practice adding schemas on a test system.\nIn the following example we’ll add one of the pre-installed policy schemas in\n/etc/ldap/schema/\n. The pre-installed schemas exists in both converted (\n.ldif\n) and native (\n.schema\n) formats, so we don’t have to convert them and can use\nldapadd\ndirectly:\nsudo ldapadd -Q -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/corba.ldif\nThe output will confirm the new schema being added:\nadding\nnew\nentry\n\"cn=corba,cn=schema,cn=config\"\nIf the schema you want to add does not exist in LDIF format, a nice conversion tool that can be used is provided in the\nschema2ldif\npackage.\nLogging\n¶\nActivity logging for\nslapd\nis very useful when implementing an OpenLDAP-based solution – and it must be manually enabled after software installation. Otherwise, only rudimentary messages will appear in the logs. Logging, like any other such configuration, is enabled via the\nslapd-config\ndatabase.\nOpenLDAP comes with multiple logging levels, with each level containing the lower one (additive). A good level to try is\nstats\n. The\nslapd-config(5)\nmanual page has more to say on the different subsystems.\nExample logging with the stats level\n¶\nCreate the file\nlogging.ldif\nwith the following contents:\ndn: cn=config\nchangetype: modify\nreplace: olcLogLevel\nolcLogLevel: stats\nRun\nldapmodify\nto implement the change:\nsudo ldapmodify -Q -Y EXTERNAL -H ldapi:/// -f logging.ldif\nDepending on how active your OpenLDAP server is, this will produce a significant amount of logging. It is recommended to revert back to a less verbose level once the need for this detailed logging isn’t there anymore.\nWhile in this verbose mode your host’s syslog engine (rsyslog) may have a hard time keeping up. If you see log message like this, it means some messages were dropped:\nrsyslogd-2177: imuxsock lost 228 messages from pid 2547 due to rate-limiting\nYou may consider a change to rsyslog’s configuration. In\n/etc/rsyslog.conf\n, add:\n# Disable rate limiting\n# (default is 200 messages in 5 seconds; below we make the 5 become 0)\n$SystemLogRateLimitInterval 0\nAnd then restart the rsyslog daemon:\nsudo systemctl restart syslog.service\nNext steps\n¶\nNow that you have successfully installed LDAP, you may want to\nset up users and groups\n, or find out more\nabout access control\n.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:25Z", "original_len_words": 2917}}
{"id": "f614e87a48", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/ldap-and-tls/", "title": "LDAP and Transport Layer Security (TLS) - Ubuntu Server documentation", "text": "LDAP and Transport Layer Security (TLS) - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nLDAP and Transport Layer Security (TLS)\n¶\nWhen authenticating to an OpenLDAP server it is best to do so using an encrypted session. This can be accomplished using Transport Layer Security (TLS).\nHere, we will be our own Certificate Authority (CA) and then create and sign our LDAP server certificate as that CA. This guide will use the\ncerttool\nutility to complete these tasks. For simplicity, this is being done on the OpenLDAP server itself, but your real internal CA should be elsewhere.\nInstall the\ngnutls-bin\nand\nssl-cert\npackages:\nsudo\napt\ninstall\ngnutls-bin\nssl-cert\nCreate a private key for the Certificate Authority:\nsudo\ncerttool\n--generate-privkey\n--bits\n4096\n--outfile\n/etc/ssl/private/mycakey.pem\nCreate the template/file\n/etc/ssl/ca.info\nto define the CA:\ncn = Example Company\nca\ncert_signing_key\nexpiration_days = 3650\nCreate the self-signed CA certificate:\nsudo\ncerttool\n--generate-self-signed\n\\\n--load-privkey\n/etc/ssl/private/mycakey.pem\n\\\n--template\n/etc/ssl/ca.info\n\\\n--outfile\n/usr/local/share/ca-certificates/mycacert.crt\nNote\nYes, the\n--outfile\npath is correct. We are writing the CA certificate to\n/usr/local/share/ca-certificates\n. This is where\nupdate-ca-certificates\nwill pick up trusted local CAs from. To pick up CAs from\n/usr/share/ca-certificates\n, a call to\ndpkg-reconfigure\nca-certificates\nis necessary.\nRun\nupdate-ca-certificates\nto add the new CA certificate to the list of trusted CAs. Note the one added CA:\n$\nsudo\nupdate-ca-certificates\nUpdating\ncertificates\nin\n/etc/ssl/certs...\n1\nadded,\n0\nremoved\n;\ndone\n.\nRunning\nhooks\nin\n/etc/ca-certificates/update.d...\ndone\n.\nThis also creates a\n/etc/ssl/certs/mycacert.pem\nsymlink pointing to the real file in\n/usr/local/share/ca-certificates\n.\nMake a private key for the server:\nsudo\ncerttool\n--generate-privkey\n\\\n--bits\n2048\n\\\n--outfile\n/etc/ldap/ldap01_slapd_key.pem\nNote\nReplace\nldap01\nin the filename with your server’s\nhostname\n. Naming the certificate and key for the host and service that will be using them will help keep things clear.\nCreate the\n/etc/ssl/ldap01.info\ninfo file containing:\norganization = Example Company\ncn = ldap01.example.com\ntls_www_server\nencryption_key\nsigning_key\nexpiration_days = 365\nThe above certificate is good for 1 year, and it’s valid only for the\nldap01.example.com\nhostname. You can adjust this according to your needs.\nCreate the server’s certificate:\nsudo\ncerttool\n--generate-certificate\n\\\n--load-privkey\n/etc/ldap/ldap01_slapd_key.pem\n\\\n--load-ca-certificate\n/etc/ssl/certs/mycacert.pem\n\\\n--load-ca-privkey\n/etc/ssl/private/mycakey.pem\n\\\n--template\n/etc/ssl/ldap01.info\n\\\n--outfile\n/etc/ldap/ldap01_slapd_cert.pem\nAdjust permissions and ownership:\nsudo\nchgrp\nopenldap\n/etc/ldap/ldap01_slapd_key.pem\nsudo\nchmod\n0640\n/etc/ldap/ldap01_slapd_key.pem\nYour server is now ready to accept the new TLS configuration.\nCreate the file\ncertinfo.ldif\nwith the following contents (adjust paths and filenames accordingly):\ndn: cn=config\nadd: olcTLSCACertificateFile\nolcTLSCACertificateFile: /etc/ssl/certs/mycacert.pem\n-\nadd: olcTLSCertificateFile\nolcTLSCertificateFile: /etc/ldap/ldap01_slapd_cert.pem\n-\nadd: olcTLSCertificateKeyFile\nolcTLSCertificateKeyFile: /etc/ldap/ldap01_slapd_key.pem\nUse the\nldapmodify\ncommand to tell\nslapd\nabout our TLS work via the\nslapd-config\ndatabase:\nsudo\nldapmodify\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\ncertinfo.ldif\nIf you need access to\nLDAPS\n(LDAP over SSL), then you need to edit\n/etc/default/slapd\nand include\nldaps:///\nin\nSLAPD_SERVICES\nlike below:\nSLAPD_SERVICES=\"ldap:/// ldapi:/// ldaps:///\"\nAnd restart\nslapd\nwith:\nsudo\nsystemctl\nrestart\nslapd\nNote that\nStartTLS\nwill be available without the change above, and does NOT need a\nslapd\nrestart.\nTest\nStartTLS\n:\n$\nldapwhoami\n-x\n-ZZ\n-H\nldap://ldap01.example.com\nanonymous\nTest LDAPS:\n$\nldapwhoami\n-x\n-H\nldaps://ldap01.example.com\nanonymous\nCertificate for an OpenLDAP replica\nTo generate a certificate pair for an OpenLDAP replica (consumer), create a holding directory (which will be used for the eventual transfer) and run the following:\nmkdir\nldap02-ssl\ncd\nldap02-ssl\ncerttool\n--generate-privkey\n\\\n--bits\n2048\n\\\n--outfile\nldap02_slapd_key.pem\nCreate an info file,\nldap02.info\n, for the Consumer server, adjusting its values according to your requirements:\norganization\n=\nExample\nCompany\ncn\n=\nldap02.example.com\ntls_www_server\nencryption_key\nsigning_key\nexpiration_days\n=\n365\nCreate the Consumer’s certificate:\nsudo\ncerttool\n--generate-certificate\n\\\n--load-privkey\nldap02_slapd_key.pem\n\\\n--load-ca-certificate\n/etc/ssl/certs/mycacert.pem\n\\\n--load-ca-privkey\n/etc/ssl/private/mycakey.pem\n\\\n--template\nldap02.info\n\\\n--outfile\nldap02_slapd_cert.pem\nNote\nWe had to use\nsudo\nto get access to the CA’s private key. This means the generated certificate file is owned by root. You should change that ownership back to your regular user before copying these files over to the Consumer.\nGet a copy of the CA certificate:\ncp\n/etc/ssl/certs/mycacert.pem\n.\nWe’re done. Now transfer the\nldap02-ssl\ndirectory to the Consumer. Here we use\nscp\n(adjust accordingly):\ncd\n..\nscp\n-r\nldap02-ssl\nuser@consumer:\nOn the Consumer side, install the certificate files you just transferred:\nsudo\ncp\nldap02_slapd_cert.pem\nldap02_slapd_key.pem\n/etc/ldap\nsudo\nchgrp\nopenldap\n/etc/ldap/ldap02_slapd_key.pem\nsudo\nchmod\n0640\n/etc/ldap/ldap02_slapd_key.pem\nsudo\ncp\nmycacert.pem\n/usr/local/share/ca-certificates/mycacert.crt\nsudo\nupdate-ca-certificates\nCreate the file\ncertinfo.ldif\nwith the following contents (adjust accordingly regarding paths and filenames, if needed):\ndn: cn=config\nadd: olcTLSCACertificateFile\nolcTLSCACertificateFile: /etc/ssl/certs/mycacert.pem\n-\nadd: olcTLSCertificateFile\nolcTLSCertificateFile: /etc/ldap/ldap02_slapd_cert.pem\n-\nadd: olcTLSCertificateKeyFile\nolcTLSCertificateKeyFile: /etc/ldap/ldap02_slapd_key.pem\nConfigure the\nslapd-config\ndatabase:\nsudo\nldapmodify\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\ncertinfo.ldif\nLike before, if you want to enable LDAPS, edit\n/etc/default/slapd\nand add\nldaps:///\nto\nSLAPD_SERVICES\n, and then restart\nslapd\n.\nTest\nStartTLS\n:\n$\nldapwhoami\n-x\n-ZZ\n-H\nldap://ldap02.example.com\nanonymous\nTest LDAPS:\n$\nldapwhoami\n-x\n-H\nldaps://ldap02.example.com\nanonymous", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:25Z", "original_len_words": 810}}
{"id": "359a2d5c94", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/ldap-saslauthd-authentication-intro/", "title": "How to configure OpenLDAP with passthrough authentication - Ubuntu Server documentation", "text": "How to configure OpenLDAP with passthrough authentication - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to configure OpenLDAP with passthrough authentication\n¶\nBackground\n¶\nManaging large groups of users is great use case for OpenLDAP, and then allowing external applications to authenticate its users against this database\nallows the applications to offload user management to OpenLDAP. A sophisticated application can use a secure authentication method such as\nGeneric Security Services Application Programming Interface\n(GSSAPI)\nto attempt to bind to the OpenLDAP server and obtain the authentication but a less sophisticated application may only be able to performs a simple bind request to OpenLDAP. This simple bind request\nsupplies a username and password to OpenLDAP and then OpenLDAP checks the password against the hashed password it has stored internally and either accepts or rejects the bind.\nObviously there is a security concern sending plain passwords over a network so this technique must only be used over a TLS connection see\nsetting up Transport Layer Security (TLS)\nWhat is passthrough authentication\n¶\nA complication occurs when the passwords storage mechanism is outside of OpenLDAP. How can this simple bind process be used without storing the password in\nthe OpenLDAP database. One solution to this problem to use use the Simple Authentication and Security Layer (SASL) library to pass though this bind request to the mechanism where the password is\nactually stored. The application that does this is the saslauthd daemon. This daemon can be configured to use various other authentication systems and will then\npass back the authentication status to OpenLDAP which in turn passes it back to the calling application.\nA graphic showing this process is as follows:\nSaslauthd authentication providers\n¶\nAuthentication providers that saslauthd can use are:\ngetpwent  – use the getpwent() library function\nkerberos5 – use Kerberos 5\npam       – use PAM\nrimap     – use a remote IMAP server\nshadow    – use the local shadow password file\nsasldb    – use the local sasldb database file\nldap      – use LDAP (configuration is in /etc/saslauthd.conf)\nReference:\nhttps://www.openldap.org/doc/admin26/sasl.html", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:25Z", "original_len_words": 360}}
{"id": "63a2c27e80", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/ldap-saslauthd-kerberos/", "title": "How to configure OpenLDAP with passthrough SASL authentication using Kerberos - Ubuntu Server documentation", "text": "How to configure OpenLDAP with passthrough SASL authentication using Kerberos - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to configure OpenLDAP with passthrough SASL authentication using Kerberos\n¶\nBefore you begin\n¶\nIt is assumed you are starting with a working OpenLDAP server, with a hostname of\nldap-server.example.com\n. If not, follow this guide\nInstall and configure OpenLDAP\nto set it up. It is also assumed that the\nEXAMPLE.COM\nrealm is set up, and the Kerberos client tools (krb5-user) are installed on the ldap server. You will need to create an ubuntu principal. See\nHow to install a Kerberos server\n. You should also know how to create service principals. See\nHow to configure Kerberos service principals\n.\nAll the following configuration will be on\nldap-server.example.com\n.\nNote\n:\nThis process is not the same as using\nGeneric Security Services Application Programming Interface\n(GSSAPI) to log into the LDAP server.\nRather it is using\nsimple authentication\nwith the OpenLDAP server so this should be over a\nTransport Layer Security\n(TLS) connection.\nThe test user we will be using is\nubuntu@EXAMPLE.COM\nwhich must exist in the Kerberos database\nHow the passthrough authentication will work\n¶\nHere is a diagram showing how all the different pieces work together:\nWe will go over all these details next.\nPackage installation\n¶\nInstall\nsaslauthd\non the OpenLDAP server (\nldap-server.example.com\nin this document):\nsudo apt install sasl2-bin\nCheck the hostname\n¶\nGet the hostname from the server\nhostname -f\nWhich should give you the hostname of:\nldap-server.example.com\nAlso check the hostname and domain using a reverse lookup with your IP. For example, if the IP address is\n10.10.17.91\n:\nnslookup 10.10.17.91\nThe reply should look like this:\n91.17.10.10.in-addr.arpa        name = ldap-server.example.com.\nIf the result is the same as your host’s canonical name them all is well. If the domain is missing, the\nFully Qualified Domain Name\n(FQDN) can be entered in the\n/etc/hosts\nfile.\nsudo vi /etc/hosts\nAdd the FQDN before the short hostname. Using the same IP as in the previous example, we would have:\n10.10.17.91 ldap-server.example.com ldap-server\nCreate the saslauthd principal\n¶\nThe\nsaslauthd\ndaemon needs a Kerberos service principal in order to authenticate itself to the Kerberos server. Such principals are created with a random password, and the resulting key is stored in\n/etc/krb5.keytab\n. For more information about Kerberos service principals, please consult\nHow to configure Kerberos service principals\n.\nThe simplest way to create this principal, and extract the key safely, is to run the\nkadmin\ntool remotely, instead of on the Kerberos server. Since the key needs to be written to\n/etc/krb5.keytab\n, the tool needs to be run with root privileges. Additionally, since creating a new service principal, as well as extracting its key, are privileged operations, we need an\n/admin\ninstance of a principal in order to be allowed these actions. In this example, we will use\nubuntu/admin\n:\nsudo kadmin -p ubuntu/admin\nAn interactive session will look like below. Note the two commands we are issuing at the\nkadmin:\nprompt:\naddprinc\nand\nktadd\n:\nAuthenticating as principal ubuntu/admin with password.\nPassword for ubuntu/admin@EXAMPLE.COM\nkadmin: addprinc -randkey host/ldap-server.example.com\nNo policy specified for host/ldap-server.example.com@EXAMPLE.COM; defaulting to no policy\nPrincipal \"host/ldap-server.example.com@EXAMPLE.COM\" created.\nkadmin: ktadd host/ldap-server.example.com\nEntry for principal host/ldap-server.example.com with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.\nEntry for principal host/ldap-server.example.com with kvno 2, encryption type aes128-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.\nAlternatively, we can issue the commands directly:\nkadmin -p ubuntu/admin -q \"addprinc -randkey host/ldap-server.example.com\"\nNOTE\nsudo\nis not needed to remotely create a new principal.\nAnd:\nsudo kadmin -p ubuntu/admin -q \"ktadd host/ldap-server.example.com\"\nTo check that the service principal was added to\n/etc/krb5.keytab\n, run this command:\nsudo klist -k\nYou should see the following:\nKeytab name: FILE:/etc/krb5.keytab\nKVNO Principal\n---- --------------------------------------------------------------------------\n   2 host/ldap-server.example.com@EXAMPLE.COM\n   2 host/ldap-server.example.com@EXAMPLE.COM\nConfigure saslauthd\n¶\nWe now need to configure\nsaslauthd\nsuch that it uses Kerberos authentication. This is an option that is selected at startup time, via command-line options. The configuration file for such options is\n/etc/default/saslauthd\n. Only one change is needed in this file: update\nMECHANISMS\nto\nkerberos5\n:\nsudo vi /etc/default/saslauthd\nMake the following change:\n...\n# Which authentication mechanisms should saslauthd use? (default: pam)\n#\n# Available options in this Debian package:\n# getpwent  -- use the getpwent() library function\n# kerberos5 -- use Kerberos 5\n# pam       -- use PAM\n# rimap     -- use a remote IMAP server\n# shadow    -- use the local shadow password file\n# sasldb    -- use the local sasldb database file\n# ldap      -- use LDAP (configuration is in /etc/saslauthd.conf)\n#\n# Only one option may be used at a time. See the saslauthd man page\n# for more information.\n#\n# Example: MECHANISMS=\"pam\"\nMECHANISMS=\"kerberos5\"\n...\nIMPORTANT\n:\nFor Ubuntu version 22.04 and earlier “\nSTART=yes\n” must also be added to the default config file for\nsaslauthd\nto start.\nSave and exit the editor.\nEnable and start saslauthd\n¶\nContinue by enabling and starting the saslauthd service.\nsudo systemctl enable --now saslauthd\nTest saslauthd configuration\n¶\nThe\nsaslauthd\nservice can be tested with with the\ntestsaslauthd\ncommand. For example, with the correct Kerberos password for the\nubuntu\nprincipal:\ntestsaslauthd -u ubuntu -p ubuntusecret\n0: OK \"Success.\"\nAnd with the wrong Kerberos password:\ntestsaslauthd -u ubuntu -p ubuntusecretwrong\n0: NO \"authentication failed\"\nNOTE\n:\nIn Ubuntu 22.04 LTS and earlier, the\n/run/saslauthd\ndirectory is restricted to members of the\nsasl\ngroup, so the\ntestsaslauthd\ncommands above need to be run as root (via\nsudo\n) or as a user who is in the\nsasl\ngroup.\nConfigure OpenLDAP\n¶\nIn order for OpenLDAP to perform passthrough authentication using\nsaslauthd\n, we need to create the configuration file\n/etc/ldap/sasl2/slapd.conf\nwith the following content:\npwcheck_method: saslauthd\nThis will direct OpenLDAP to use\nsaslauthd\nas the password checking mechanism when performing passthrough authentication on behalf of a user.\nIn Ubuntu 22.04 LTS and earlier, the\nopenldap\nsystem user needs to be added to the\nsasl\ngroup, or else it will not have permission to contact the\nsaslauthd\nunix socket in\n/run/saslauthd/\n. To make this change, run:\nsudo\ngpasswd\n-\na\nopenldap\nsasl\nFinally, restart the OpenLDAP service:\nsudo\nsystemctl\nrestart\nslapd\n.\nservice\nChange the\nuserPassword\nattribute\n¶\nWhat triggers OpenLDAP to perform a passthrough authentication when processing a simple bind authentication request, is the special content of the\nuserPassword\nattribute. Normally, that attribute contains some form of password hash, which is used to authenticate the request. If, however, what it contains is in the format of\n{SASL}username@realm\n, then OpenLDAP will delegate the authentication to the SASL library, whose configuration is in that file we just created above.\nFor example, let’s examine the directory entry below:\ndn: uid=ubuntu,dc=example,dc=com\nuid: ubuntu\nobjectClass: account\nobjectClass: simpleSecurityObject\nuserPassword: {SSHA}S+WlmGneLDFeCwErKnY4mJngnVJMZAM5\nIf a simple bind is performed using a binddn of\nuid=ubuntu,dc=example,dc=com\n, the password will be checked against the hashed\nuserPassword\nvalue as normal. That is, no passthrough authentication will be done at all.\nHowever, if the\nuserPassword\nattribute is in this format:\nuserPassword: {SASL}ubuntu@EXAMPLE.COM\nThat will trigger the passthrough authentication, because the\nuserPassword\nattribute starts with the special prefix\n{SASL}\n. This will direct OpenLDAP to use\nsaslauthd\nfor the authentication, and use the name provided in the\nuserPassword\nattribute.\nIMPORTANT\nNote how the username present in the\nuserPassword\nattribute is independent of the binddn used in the simple bind! If the\nuserPassword\nattribute contained, say,\n{SASL}anotheruser@EXAMPLE.COM\n, OpenLDAP would ask\nsaslauthd\nto authenticate\nanotheruser@EXAMPLE.COM\n, and not the user from the binddn! Therefore, it’s important to use OpenLDAP ACLs to prevent users from changing the\nuserPassword\nattribute when using passthrough authentication!\nTo continue with this how-to, let’s create the\nuid=ubuntu\nentry in the directory, which will use passthrough authentication:\nldapadd -x -D cn=admin,dc=example,dc=com -W <<LDIF\ndn: uid=ubuntu,dc=example,dc=com\nuid: ubuntu\nobjectClass: account\nobjectClass: simpleSecurityObject\nuserPassword: {SASL}ubuntu@EXAMPLE.COM\nLDIF\nNOTE\nNote how we don’t need to add the posix attributes like user id, home directory, group, etc. All we really need is a directory entry that contains a\nuserPassword\nattribute.\nTest the authentication\n¶\nTo test that the simple bind is working, and using the Kerberos password for the\nubuntu\nuser, let’s use\nldapwhoami\n:\nldapwhoami -D uid=ubuntu,dc=example,dc=com -W -x\nEnter LDAP Password:\nA successful bind will look like\ndn:uid=ubuntu,dc=example,dc=com\nA failed bind will look like\nldap_bind: Invalid credentials (49)\nThese LDAP bind DNs can now be used with external applications that only support “simple” username and password authentication, and they will be authenticated against Kerberos behind the scenes.\nTroubleshooting\n¶\nSaslauthd can be run in debug mode for more verbose messages to aid in troubleshooting\nsudo systemctl stop saslauthd\nsudo /usr/sbin/saslauthd -a kerberos5 -d -m /var/run/saslauthd -n 1\nAlso the\n/var/log/auth.log\nfile can be checked for saslauthd log entries\nAdvanced options\n¶\nSaslauthd can be configured in the\n/etc/saslauthd.conf\nfile. The settings depend on the authorization mechanism configured in\n/etc/default/saslauthd\n, which in this case is\nkerberos5\n.\nSome options are:\nkrb5_keytab\n: Override the default keytab file location of\n/etc/krb5.keytab\n.\nkrb5_verify_principal\n: Change the name of the Kerberos service principal used by\nsaslauthd\n.\nFor example, with this content in\n/etc/saslauthd.conf\n:\nkrb5_keytab: /etc/saslauthd.keytab\nkrb5_verify_principal: saslauthd\nWe have changed the keytab file to\n/etc/saslauthd.keytab\n, and the service principal that\nsaslauthd\nwill use to authenticate itself with the Kerberos server becomes\nsaslauthd/ldap-server.example.com@EXAMPLE.COM\n(following this how-to). Note how the domain and realm names remain the same in this service principal, and only the actual principal name is affected (changed from the default value of\nhost\nto\nsaslauthd\n).\nReferences\n¶\nOpenLDAP Passthrough Authentication\nCyrus SASL Password Verification\nCyrus SASL Slapd Configuration File\nKerberos Client Hostname Requirements", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:26Z", "original_len_words": 1623}}
{"id": "f1ac10b3c8", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/replication/", "title": "OpenLDAP replication - Ubuntu Server documentation", "text": "OpenLDAP replication - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nOpenLDAP replication\n¶\nThe LDAP service becomes increasingly important as more networked systems begin to depend on it. In such an environment, it is standard practice to build redundancy (\nhigh availability\n) into LDAP to prevent disruption should the LDAP server become unresponsive. This is done through\nLDAP replication\n.\nReplication is achieved via the Sync replication engine,\nsyncrepl\n. This allows changes to be synchronized using a\nConsumer - Provider\nmodel. A detailed description of this replication mechanism can be found in the\nOpenLDAP administrator’s guide\nand in its defining\nRFC 4533\n.\nThere are two ways to use this replication:\nStandard replication\n: Changed entries are sent to the consumer in their entirety. For example, if the\nuserPassword\nattribute of the\nuid=john,ou=people,dc=example,dc=com\nentry changed, then the whole entry is sent to the consumer.\nDelta replication\n: Only the actual change is sent, instead of the whole entry.\nThe delta replication sends less data over the network, but is more complex to set up. We will show both in this guide.\nImportant\nYou\nmust\nhave Transport Layer Security (TLS) enabled already before proceeding with this guide. Please consult the\nLDAP with TLS guide\nfor details of how to set this up.\nProvider configuration - replication user\n¶\nBoth replication strategies will need a replication user, as well as updates to the\nACL\ns and limits regarding this user. To create the replication user, save the following contents to a file called\nreplicator.ldif\n:\ndn: cn=replicator,dc=example,dc=com\nobjectClass: simpleSecurityObject\nobjectClass: organizationalRole\ncn: replicator\ndescription: Replication user\nuserPassword: {CRYPT}x\nThen add it with\nldapadd\n:\n$\nldapadd\n-x\n-ZZ\n-H\nldap://ldap01.example.com\n-D\ncn\n=\nadmin,dc\n=\nexample,dc\n=\ncom\n-W\n-f\nreplicator.ldif\nEnter\nLDAP\nPassword:\nadding\nnew\nentry\n\"cn=replicator,dc=example,dc=com\"\nNow set a password for it with\nldappasswd\n:\n$\nldappasswd\n-x\n-ZZ\n-H\nldap://ldap01.example.com\n-D\ncn\n=\nadmin,dc\n=\nexample,dc\n=\ncom\n-W\n-S\ncn\n=\nreplicator,dc\n=\nexample,dc\n=\ncom\nNew\npassword:\nRe-enter\nnew\npassword:\nEnter\nLDAP\nPassword:\nNote\nPlease adjust the server URI in the\n-H\nparameter if needed to match your deployment.\nThe next step is to give this replication user the correct privileges, i.e.:\nRead access to the content that we want replicated\nNo search limits on this content\nFor that we need to update the ACLs on the provider. Since ordering matters, first check what the existing ACLs look like on the\ndc=example,dc=com\ntree:\n$\nsudo\nldapsearch\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-LLL\n-b\ncn\n=\nconfig\n'(olcSuffix=dc=example,dc=com)'\nolcAccess\ndn:\nolcDatabase\n={\n1\n}\nmdb,cn\n=\nconfig\nolcAccess:\n{\n0\n}\nto\nattrs\n=\nuserPassword\nby\nself\nwrite\nby\nanonymous\nauth\nby\n*\nnone\nolcAccess:\n{\n1\n}\nto\nattrs\n=\nshadowLastChange\nby\nself\nwrite\nby\n*\nread\nolcAccess:\n{\n2\n}\nto\n*\nby\n*\nread\nWhat we need is to insert a new rule before the first one, and also adjust the limits for the replicator user. Prepare the\nreplicator-acl-limits.ldif\nfile with this content:\ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nadd: olcAccess\nolcAccess: {0}to *\n  by dn.exact=\"cn=replicator,dc=example,dc=com\" read\n  by * break\n-\nadd: olcLimits\nolcLimits: dn.exact=\"cn=replicator,dc=example,dc=com\"\n  time.soft=unlimited time.hard=unlimited\n  size.soft=unlimited size.hard=unlimited\nAnd add it to the server:\n$\nsudo\nldapmodify\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\nreplicator-acl-limits.ldif\nmodifying\nentry\n\"olcDatabase={1}mdb,cn=config\"\nProvider configuration - standard replication\n¶\nThe remaining configuration for the provider using standard replication is to add the\nsyncprov\noverlay on top of the\ndc=example,dc=com\ndatabase.\nCreate a file called\nprovider_simple_sync.ldif\nwith this content:\n# Add indexes to the frontend db.\ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nadd: olcDbIndex\nolcDbIndex: entryCSN eq\n-\nadd: olcDbIndex\nolcDbIndex: entryUUID eq\n\n#Load the syncprov module.\ndn: cn=module{0},cn=config\nchangetype: modify\nadd: olcModuleLoad\nolcModuleLoad: syncprov\n\n# syncrepl Provider for primary db\ndn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config\nchangetype: add\nobjectClass: olcOverlayConfig\nobjectClass: olcSyncProvConfig\nolcOverlay: syncprov\nolcSpCheckpoint: 100 10\nolcSpSessionLog: 100\nWarning\nThe LDIF above has some parameters that you should review before deploying in production on your directory. In particular –\nolcSpCheckpoint\nand\nolcSpSessionLog\n.\nPlease see the\nslapo-syncprov(5)\nmanual page. In general,\nolcSpSessionLog\nshould be equal to (or preferably larger than) the number of entries in your directory. Also see\nITS #8125\nfor details on an existing bug.\nAdd the new content:\nsudo\nldapadd\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\nprovider_simple_sync.ldif\nThe Provider is now configured.\nConsumer configuration - standard replication\n¶\nInstall the software by going through\nthe installation steps\n. Make sure schemas and the database suffix are the same, and\nenable TLS\n.\nCreate an LDIF file with the following contents and name it\nconsumer_simple_sync.ldif\n:\ndn: cn=module{0},cn=config\nchangetype: modify\nadd: olcModuleLoad\nolcModuleLoad: syncprov\n\ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nadd: olcDbIndex\nolcDbIndex: entryUUID eq\n-\nadd: olcSyncrepl\nolcSyncrepl: rid=0\n  provider=ldap://ldap01.example.com\n  bindmethod=simple\n  binddn=\"cn=replicator,dc=example,dc=com\" credentials=<secret>\n  searchbase=\"dc=example,dc=com\"\n  schemachecking=on\n  type=refreshAndPersist retry=\"60 +\"\n  starttls=critical tls_reqcert=demand\n-\nadd: olcUpdateRef\nolcUpdateRef: ldap://ldap01.example.com\nEnsure the following attributes have the correct values:\nprovider\n: Provider server’s\nhostname\n–\nldap01.example.com\nin this example – or IP address. It must match what is presented in the provider’s SSL certificate.\nbinddn\n: The bind\nDN\nfor the replicator user.\ncredentials\n: The password you selected for the replicator user.\nsearchbase\n: The database suffix you’re using, i.e., content that is to be replicated.\nolcUpdateRef\n: Provider server’s hostname or IP address, given to clients if they try to write to this consumer.\nrid\n: Replica ID, a unique 3-digit ID that identifies the replica. Each consumer should have at least one\nrid\n.\nNote\nA successful encrypted connection via\nSTART_TLS\nis being enforced in this configuration, to avoid sending the credentials in the clear across the network. See\nLDAP with TLS\nfor details on how to set up OpenLDAP with trusted SSL certificates.\nAdd the new configuration:\nsudo\nldapadd\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\nconsumer_simple_sync.ldif\nNow you’re done! The\ndc=example,dc=com\ntree should now be synchronising.\nProvider configuration - delta replication\n¶\nThe remaining provider configuration for delta replication is:\nCreate a new database called\naccesslog\nAdd the\nsyncprov\noverlay on top of the\naccesslog\nand\ndc=example,dc=com\ndatabases\nAdd the\naccesslog\noverlay on top of the\ndc=example,dc=com\ndatabase\nAdd\nsyncprov\nand\naccesslog\noverlays and DBs\n¶\nCreate an LDIF file with the following contents and name it\nprovider_sync.ldif\n:\n# Add indexes to the frontend db.\ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nadd: olcDbIndex\nolcDbIndex: entryCSN eq\n-\nadd: olcDbIndex\nolcDbIndex: entryUUID eq\n    \n#Load the syncprov and accesslog modules.\ndn: cn=module{0},cn=config\nchangetype: modify\nadd: olcModuleLoad\nolcModuleLoad: syncprov\n-\nadd: olcModuleLoad\nolcModuleLoad: accesslog\n    \n# Accesslog database definitions\ndn: olcDatabase={2}mdb,cn=config\nobjectClass: olcDatabaseConfig\nobjectClass: olcMdbConfig\nolcDatabase: {2}mdb\nolcDbDirectory: /var/lib/ldap/accesslog\nolcSuffix: cn=accesslog\nolcRootDN: cn=admin,dc=example,dc=com\nolcDbIndex: default eq\nolcDbIndex: entryCSN,objectClass,reqEnd,reqResult,reqStart\nolcAccess: {0}to * by dn.exact=\"cn=replicator,dc=example,dc=com\" read by * break\nolcLimits: dn.exact=\"cn=replicator,dc=example,dc=com\"\n  time.soft=unlimited time.hard=unlimited\n  size.soft=unlimited size.hard=unlimited\n    \n# Accesslog db syncprov.\ndn: olcOverlay=syncprov,olcDatabase={2}mdb,cn=config\nchangetype: add\nobjectClass: olcOverlayConfig\nobjectClass: olcSyncProvConfig\nolcOverlay: syncprov\nolcSpNoPresent: TRUE\nolcSpReloadHint: TRUE\n    \n# syncrepl Provider for primary db\ndn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config\nchangetype: add\nobjectClass: olcOverlayConfig\nobjectClass: olcSyncProvConfig\nolcOverlay: syncprov\nolcSpCheckpoint: 100 10\nolcSpSessionLog: 100\n    \n# accesslog overlay definitions for primary db\ndn: olcOverlay=accesslog,olcDatabase={1}mdb,cn=config\nobjectClass: olcOverlayConfig\nobjectClass: olcAccessLogConfig\nolcOverlay: accesslog\nolcAccessLogDB: cn=accesslog\nolcAccessLogOps: writes\nolcAccessLogSuccess: TRUE\n# scan the accesslog DB every day, and purge entries older than 7 days\nolcAccessLogPurge: 07+00:00 01+00:00\nWarning\nThe LDIF above has some parameters that you should review before deploying in production on your directory. In particular –\nolcSpCheckpoint\n,\nolcSpSessionLog\n.\nPlease see the\nslapo-syncprov(5)\nmanpage. In general,\nolcSpSessionLog\nshould be equal to (or preferably larger than) the number of entries in your directory. Also see\nITS #8125\nfor details on an existing bug.\nFor\nolcAccessLogPurge\n, please check the\nslapo-accesslog(5)\nmanpage.\nCreate a directory:\nsudo\n-u\nopenldap\nmkdir\n/var/lib/ldap/accesslog\nAdd the new content:\nsudo\nldapadd\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\nprovider_sync.ldif\nThe Provider is now configured.\nConsumer configuration\n¶\nInstall the software by going through\nthe installation steps\n. Make sure schemas and the database suffix are the same, and\nenable TLS\n.\nCreate an LDIF file with the following contents and name it\nconsumer_sync.ldif\n:\ndn: cn=module{0},cn=config\nchangetype: modify\nadd: olcModuleLoad\nolcModuleLoad: syncprov\n    \ndn: olcDatabase={1}mdb,cn=config\nchangetype: modify\nadd: olcDbIndex\nolcDbIndex: entryUUID eq\n-\nadd: olcSyncrepl\nolcSyncrepl: rid=0\n  provider=ldap://ldap01.example.com\n  bindmethod=simple\n  binddn=\"cn=replicator,dc=example,dc=com\" credentials=<secret>\n  searchbase=\"dc=example,dc=com\"\n  logbase=\"cn=accesslog\"\n  logfilter=\"(&(objectClass=auditWriteObject)(reqResult=0))\"\n  schemachecking=on\n  type=refreshAndPersist retry=\"60 +\"\n  syncdata=accesslog\n  starttls=critical tls_reqcert=demand\n-\nadd: olcUpdateRef\nolcUpdateRef: ldap://ldap01.example.com\nEnsure the following attributes have the correct values:\nprovider\n: Provider server’s hostname –\nldap01.example.com\nin this example – or IP address. It must match what is presented in the provider’s SSL certificate.\nbinddn\n: The bind DN for the replicator user.\ncredentials\n: The password you selected for the replicator user.\nsearchbase\n: The database suffix you’re using, i.e., content that is to be replicated.\nolcUpdateRef\n: Provider server’s hostname or IP address, given to clients if they try to write to this consumer.\nrid\n: Replica ID, a unique 3-digit ID that identifies the replica. Each consumer should have at least one\nrid\n.\nNote\nNote that a successful encrypted connection via\nSTART_TLS\nis being enforced in this configuration, to avoid sending the credentials in the clear across the network. See\nLDAP with TLS\nfor details on how to set up OpenLDAP with trusted SSL certificates.\nAdd the new configuration:\nsudo\nldapadd\n-Q\n-Y\nEXTERNAL\n-H\nldapi:///\n-f\nconsumer_sync.ldif\nYou’re done! The\ndc=example,dc=com\ntree should now be synchronising.\nTesting\n¶\nOnce replication starts, you can monitor it by running:\n$\nldapsearch\n-z1\n-LLL\n-x\n-s\nbase\n-b\ndc\n=\nexample,dc\n=\ncom\ncontextCSN\ndn:\ndc\n=\nexample,dc\n=\ncom\ncontextCSN:\n20200423222317\n.722667Z#000000#000#000000\nOn both the provider and the consumer. Once the\ncontextCSN\nvalue for both match, both trees are in sync. Every time a change is done in the provider, this value will change and so should the one in the consumer(s).\nIf your connection is slow and/or your LDAP database large, it might take a while for the consumer’s\ncontextCSN\nmatch the provider’s. But, you will know it is progressing since the consumer’s\ncontextCSN\nwill be steadily increasing.\nIf the consumer’s\ncontextCSN\nis missing or does not match the provider, you should stop and figure out the issue before continuing. Try checking the\nslapd\nentries in\n/var/log/syslog\nin the provider to see if the consumer’s authentication requests were successful, or that its requests to retrieve data return no errors. In particular, verify that you can connect to the provider from the consumer as the replicator BindDN using\nSTART_TLS\n:\nldapwhoami\n-x\n-ZZ\n-H\nldap://ldap01.example.com\n-D\ncn\n=\nreplicator,dc\n=\nexample,dc\n=\ncom\n-W\nFor our example, you should now see the\njohn\nuser in the replicated tree:\n$\nldapsearch\n-x\n-LLL\n-H\nldap://ldap02.example.com\n-b\ndc\n=\nexample,dc\n=\ncom\n'(uid=john)'\nuid\ndn:\nuid\n=\njohn,ou\n=\nPeople,dc\n=\nexample,dc\n=\ncom\nuid:\njohn\nReferences\n¶\nReplication types, OpenLDAP Administrator’s Guide\nLDAP Sync Replication - OpenLDAP Administrator’s Guide\nRFC 4533\n.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:26Z", "original_len_words": 1797}}
{"id": "0d140fdc03", "source_url": "https://documentation.ubuntu.com/server/how-to/openldap/users-and-groups/", "title": "How to set up LDAP users and groups - Ubuntu Server documentation", "text": "How to set up LDAP users and groups - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nHow to set up LDAP users and groups\n¶\nOnce you\nhave a working LDAP server\n, you will need to install libraries on the client that know how and when to contact it. On Ubuntu, this was traditionally done by installing the\nlibnss-ldap\npackage, but nowadays you should use the\nSystem Security Services Daemon (SSSD)\n. To find out how to use LDAP with SSSD, refer to\nour SSSD and LDAP\nguide.\nUser and group management -\nldapscripts\n¶\nA common use case for an LDAP server is to store UNIX user and group information in the directory. There are many tools out there, and big deployments will usually develop their own. However, as a quick and easy way to get started with storing user and group information in OpenLDAP, you can use the\nldapscripts\npackage.\nInstall ldapscripts\n¶\nYou can install\nldapscripts\nby running the following command:\nsudo\napt\ninstall\nldapscripts\nThen edit the file\n/etc/ldapscripts/ldapscripts.conf\nto arrive at something similar to the following:\nSERVER=ldap://ldap01.example.com\nLDAPBINOPTS=\"-ZZ\"\nBINDDN='cn=admin,dc=example,dc=com'\nBINDPWDFILE=\"/etc/ldapscripts/ldapscripts.passwd\"\nSUFFIX='dc=example,dc=com'\nGSUFFIX='ou=Groups'\nUSUFFIX='ou=People'\nMSUFFIX='ou=Computers'\nNote\nAdjust\nSERVER\nand related\nSUFFIX\noptions to suit your directory structure.\nHere, we are forcing use of\nSTART_TLS\n(\n-ZZ\nparameter). Refer to\nLDAP with TLS\nto learn how to set up the server with TLS support.\nStore the\ncn=admin\npassword in the\n/etc/ldapscripts/ldapscripts.passwd\nfile and make sure it’s only readable by the\nroot\nlocal user:\necho\n-n\n'password'\n|\nsudo\ntee\n/etc/ldapscripts/ldapscripts.passwd\nsudo\nchmod\n400\n/etc/ldapscripts/ldapscripts.passwd\nNote\n:\nThe password file must contain exactly and only the password characters, no end-of-line or anything else. The\necho\ncommand above with the\n-n\nparameter achieves that by suppressing the\nEOL\ncharacter\n\\n\n. And in order to prevent the password from appearing in the shell history, the\necho\ncommand line is prefixed by a space.\nThe scripts are now ready to help manage your directory.\nManage users and groups with ldapscripts\n¶\nHere are some brief examples you can use to manage users and groups using\nldapscripts\n.\nCreate a new user\n¶\nsudo\nldapaddgroup\ngeorge\nsudo\nldapadduser\ngeorge\ngeorge\nThis will create a group and user with name “george” and set the user’s primary group (\ngid\n) to “george” as well.\nChange a user’s password\n¶\n$\nsudo\nldapsetpasswd\ngeorge\n\nChanging\npassword\nfor\nuser\nuid\n=\ngeorge,ou\n=\nPeople,dc\n=\nexample,dc\n=\ncom\nNew\nPassword:\nRetype\nNew\nPassword:\nSuccessfully\nset\npassword\nfor\nuser\nuid\n=\ngeorge,ou\n=\nPeople,dc\n=\nexample,dc\n=\ncom\nDelete a user\n¶\nsudo\nldapdeleteuser\ngeorge\nNote that this won’t delete the user’s primary group, but will remove the user from supplementary ones.\nAdd a group\n¶\nsudo\nldapaddgroup\nqa\nDelete a group\n¶\nsudo\nldapdeletegroup\nqa\nAdd a user to a group\n¶\nsudo\nldapaddusertogroup\ngeorge\nqa\nYou should now see a\nmemberUid\nattribute for the\nqa\ngroup with a value of\ngeorge\n.\nRemove a user from a group\n¶\nsudo\nldapdeleteuserfromgroup\ngeorge\nqa\nThe\nmemberUid\nattribute should now be removed from the\nqa\ngroup.\nManage user attributes with\nldapmodifyuser\n¶\nThe\nldapmodifyuser\nscript allows you to add, remove, or replace a user’s attributes. The script uses the same syntax as the\nldapmodify\nutility. For example:\nsudo\nldapmodifyuser\ngeorge\n# About to modify the following entry :\ndn:\nuid\n=\ngeorge,ou\n=\nPeople,dc\n=\nexample,dc\n=\ncom\nobjectClass:\naccount\nobjectClass:\nposixAccount\ncn:\ngeorge\nuid:\ngeorge\nuidNumber:\n10001\ngidNumber:\n10001\nhomeDirectory:\n/home/george\nloginShell:\n/bin/bash\ngecos:\ngeorge\ndescription:\nUser\naccount\nuserPassword::\ne1NTSEF9eXFsTFcyWlhwWkF1eGUybVdFWHZKRzJVMjFTSG9vcHk\n=\n# Enter your modifications here, end with CTRL-D.\ndn:\nuid\n=\ngeorge,ou\n=\nPeople,dc\n=\nexample,dc\n=\ncom\nreplace:\ngecos\ngecos:\nGeorge\nCarlin\nThe user’s\ngecos\nshould now be “George Carlin”.\nldapscripts\ntemplates\n¶\nA nice feature of\nldapscripts\nis the template system. Templates allow you to customize the attributes of user, group, and machine objects. For example, to enable the\nuser\ntemplate, edit\n/etc/ldapscripts/ldapscripts.conf\nby changing:\nUTEMPLATE=\"/etc/ldapscripts/ldapadduser.template\"\nThere are sample templates in the\n/usr/share/doc/ldapscripts/examples\ndirectory. Copy or rename the\nldapadduser.template.sample\nfile to\n/etc/ldapscripts/ldapadduser.template\n:\nsudo\ncp\n/usr/share/doc/ldapscripts/examples/ldapadduser.template.sample\n\\\n/etc/ldapscripts/ldapadduser.template\nEdit the new template to add the desired attributes. The following will create new users with an\nobjectClass\nof\ninetOrgPerson\n:\ndn: uid=<user>,<usuffix>,<suffix>\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\ncn: <user>\nsn: <ask>\nuid: <user>\nuidNumber: <uid>\ngidNumber: <gid>\nhomeDirectory: <home>\nloginShell: <shell>\ngecos: <user>\ndescription: User account\ntitle: Employee\nNotice the\n<ask>\noption used for the\nsn\nattribute. This will make\nldapadduser\nprompt you for its value.\nThere are utilities in the package that were not covered here. This command will output a list of them:\ndpkg\n-L\nldapscripts\n|\ngrep\n/usr/sbin\nNext steps\n¶\nNow that you know how to set up and modify users and groups, it’s a good idea to secure your LDAP communication by\nsetting up Transport Layer Security (TLS)\n.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:26Z", "original_len_words": 824}}
{"id": "37147f6535", "source_url": "https://documentation.ubuntu.com/server/how-to/samba/", "title": "Samba - Ubuntu Server documentation", "text": "Samba - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nSamba\n¶\nA Samba server can be deployed as a full Active Directory Domain Controller (Samba AD/DC), providing authentication to domain users – whether Linux or Windows.\nSet up a Samba AD Domain Controller\nJoin an Active Directory domain\nSet up sharing services\n¶\nSamba can be configured as a file server or print server, to share files and printers with Windows clients.\nSet up a file server\nSet up a print server\nAccess controls\n¶\nShare access controls\nCreate AppArmor profile\nMount CIFS shares permanently\nLegacy options\n¶\nThese options are now deprecated, but still available.\nNT4 domain controller\nOpenLDAP backend\nSee also\n¶\nExplanation:\nIntroduction to Samba", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:26Z", "original_len_words": 140}}
{"id": "4c2dae513a", "source_url": "https://documentation.ubuntu.com/server/how-to/samba/apparmor-profile/", "title": "Create a Samba AppArmor profile - Ubuntu Server documentation", "text": "Create a Samba AppArmor profile - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nCreate a Samba AppArmor profile\n¶\nUbuntu comes with the AppArmor security module, which provides mandatory access controls. The default AppArmor profile for Samba may need to be adapted to your configuration. More details on using AppArmor can be found\nin this guide\n.\nThere are default AppArmor profiles for\n/usr/sbin/smbd\nand\n/usr/sbin/nmbd\n, the Samba daemon binaries, as part of the\napparmor-profiles\npackage.\nInstall\napparmor-profiles\n¶\nTo install the package, enter the following command from a terminal prompt:\nsudo\napt\ninstall\napparmor-profiles\napparmor-utils\nNote\nThis package contains profiles for several other binaries.\nAppArmor profile modes\n¶\nBy default, the profiles for\nsmbd\nand\nnmbd\nare set to ‘complain’ mode. In this mode, Samba can work without modifying the profile, and only logs errors or violations. There is no need to add exceptions for the shares, as the\nsmbd\nservice unit takes care of doing that automatically via a helper script.\nThis is what an\nALLOWED\nmessage looks like. It means that, were the profile not in\ncomplain\nmode, this action would have been denied instead (formatted into multiple lines here for better visibility):\nJun 30 14:41:09 ubuntu kernel: [  621.478989] audit: \ntype=1400 audit(1656600069.123:418):\napparmor=\"ALLOWED\" operation=\"exec\" profile=\"smbd\"\nname=\"/usr/lib/x86_64-linux-gnu/samba/samba-bgqd\" pid=4122 comm=\"smbd\"\nrequested_mask=\"x\" denied_mask=\"x\" fsuid=0 ouid=0\ntarget=\"smbd//null-/usr/lib/x86_64-linux-gnu/samba/samba-bgqd\"\nThe alternative to ‘complain’ mode is ‘enforce’ mode, where any operations that violate policy are blocked. To place the profile into\nenforce\nmode and reload it, run:\nsudo\naa-enforce\n/usr/sbin/smbd\nsudo\napparmor_parser\n-r\n-W\n-T\n/etc/apparmor.d/usr.sbin.smbd\nIt’s advisable to monitor\n/var/log/syslog\nfor\naudit\nentries that contain AppArmor\nDENIED\nmessages, or\n/var/log/audit/audit.log\nif you are running the\nauditd\ndaemon. Actions blocked by AppArmor may surface as odd or unrelated errors in the application.\nFurther reading\n¶\nFor more information on how to use AppArmor, including details of the profile modes,\nthe Debian AppArmor guide\nmay be helpful.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:27Z", "original_len_words": 336}}
{"id": "7018e3a7c3", "source_url": "https://documentation.ubuntu.com/server/how-to/samba/file-server/", "title": "Set up Samba as a file server - Ubuntu Server documentation", "text": "Set up Samba as a file server - Ubuntu Server documentation\nContents\nMenu\nExpand\nLight mode\nDark mode\nAuto light/dark, in light mode\nAuto light/dark, in dark mode\nSkip to content\nBack to top\nView this page\nSet up Samba as a file server\n¶\nOne of the most common ways to network Ubuntu and Windows computers is to configure Samba as a\nfile server\n. It can be set up to share files with Windows clients, as we’ll see in this section.\nThe server will be configured to share files with any client on the network without prompting for a password. If your environment requires stricter Access Controls see\nShare Access Control\n.\nWarning\nIf you use\nSamba and authd\nat the same time, you must specify user and group mapping. Otherwise, you will encounter permission issues due to mismatched user and group identifiers.\nIf you\nare\nusing Samba with authd, you should follow the instructions in the\nsteps for the server\nguide in the authd documentation instead.\nInstall Samba\n¶\nThe first step is to install the\nsamba\npackage. From a terminal prompt enter:\nsudo\napt\ninstall\nsamba\nThat’s all there is to it; you are now ready to configure Samba to share files.\nConfigure Samba as a file server\n¶\nThe main Samba configuration file is located in\n/etc/samba/smb.conf\n. The default configuration file contains a significant number of comments, which document various configuration directives.\nNote\nNot all available options are included in the default configuration file. See the\nsmb.conf\nman page\nor the\nSamba HOWTO Collection\nfor more details.\nFirst, edit the\nworkgroup\nparameter in the\n[global]\nsection of\n/etc/samba/smb.conf\nand change it to better match your environment:\nworkgroup = EXAMPLE\nCreate a new section at the bottom of the file, or uncomment one of the examples, for the directory you want to share:\n[share]\n    comment = Ubuntu File Server Share\n    path = /srv/samba/share\n    browsable = yes\n    guest ok = yes\n    read only = no\n    create mask = 0755\ncomment\nA short description of the share. Adjust to fit your needs.\npath\nThe path to the directory you want to share.\nNote\nThis example uses\n/srv/samba/sharename\nbecause, according to the\nFilesystem Hierarchy Standard (FHS)\n,\n/srv\nis where site-specific data should be served. Technically, Samba shares can be placed anywhere on the\nfilesystem\nas long as the permissions are correct, but adhering to standards is recommended.\nbrowsable\nEnables Windows clients to browse the shared directory using Windows Explorer.\nguest\nok\nAllows clients to connect to the share without supplying a password.\nread\nonly\ndetermines if the share is read only or if write privileges are granted. Write privileges are allowed only when the value is\nno\n, as is seen in this example. If the value is\nyes\n, then access to the share is read only.\ncreate\nmask\nDetermines the permissions that new files will have when created.\nCreate the directory\n¶\nNow that Samba is configured, the directory needs to be created and the permissions changed. From a terminal, run the following commands:\nsudo\nmkdir\n-p\n/srv/samba/share\nsudo\nchown\nnobody:nogroup\n/srv/samba/share/\nThe\n-p\nswitch tells\nmkdir\nto create the entire directory tree if it doesn’t already exist.\nEnable the new configuration\n¶\nFinally, restart the Samba services to enable the new configuration by running the following command:\nsudo\nsystemctl\nrestart\nsmbd.service\nnmbd.service\nWarning\nOnce again, the above configuration gives full access to any client on the local network. For a more secure configuration see\nShare Access Control\n.\nFrom a Windows client you should now be able to browse to the Ubuntu file server and see the shared directory. If your client doesn’t show your share automatically, try to access your server by its IP address, e.g.\n\\\\192.168.1.1\n, in a Windows Explorer window. To check that everything is working try creating a directory from Windows.\nTo create additional shares simply create new\n[sharename]\nsections in\n/etc/samba/smb.conf\n, and restart Samba. Just make sure that the directory you want to share actually exists and the permissions are correct.\nThe file share named\n[share]\nand the path\n/srv/samba/share\nused in this example can be adjusted to fit your environment. It is a good idea to name a share after a directory on the file system. Another example would be a share name of\n[qa]\nwith a path of\n/srv/samba/qa\n.\nFurther reading\n¶\nFor in-depth Samba configurations see the\nSamba how-to collection\nThe guide is also available\nin printed format\n.\nO’Reilly’s\nUsing Samba\nis another good reference.\nThe\nUbuntu Wiki Samba\npage.", "meta": {"site": "documentation.ubuntu.com", "crawl_ts": "2025-11-27T10:38:27Z", "original_len_words": 758}}
